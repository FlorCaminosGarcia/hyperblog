"use strict";exports.id=974,exports.ids=[593,974],exports.modules={1362:(e,o,s)=>{s.d(o,{fromSSO:()=>I});var t=s(68),n=s(70),r=s(1364),i=s(74),a=s(73),c=s(72);const l=e=>Object.entries(e).filter((([e])=>e.startsWith(a.I.SSO_SESSION+c.Q))).reduce(((e,[o,s])=>({...e,[o.substring(o.indexOf(c.Q)+1)]:s})),{});var f=s(76),g=s(77);const w=()=>({}),h=async(e={})=>(0,g.$H)(e.configFilepath??(0,i.g)()).then(f.A).then(l).catch(w);var d=s(43),u=s(69);class p extends u.m{name="TokenProviderError";constructor(e,o=!0){super(e,o),Object.setPrototypeOf(this,p.prototype)}}var S=s(1365);const C="To refresh this SSO session run 'aws sso login' with the corresponding profile.",y=async(e,o,t={})=>{const{CreateTokenCommand:n}=await s.e(364).then(s.bind(s,1375)),r=await(async(e,o={})=>{const{SSOOIDCClient:t}=await s.e(364).then(s.bind(s,1375));return new t(Object.assign({},o.clientConfig??{},{region:e??o.clientConfig?.region,logger:o.clientConfig?.logger??o.parentClientConfig?.logger}))})(o,t);return r.send(new n({clientId:e.clientId,clientSecret:e.clientSecret,refreshToken:e.refreshToken,grantType:"refresh_token"}))},k=e=>{if(e.expiration&&e.expiration.getTime()<Date.now())throw new p(`Token is expired. ${C}`,!1)},_=(e,o,s=!1)=>{if(void 0===o)throw new p(`Value not present for '${e}' in SSO Token${s?". Cannot refresh":""}. ${C}`,!1)};var m=s(1363),O=s(10);const{writeFile:x}=O.promises,T=new Date(0),v=(e={})=>async({callerClientConfig:o}={})=>{const s={...e,parentClientConfig:{...o,...e.parentClientConfig}};s.logger?.debug("@aws-sdk/token-providers - fromSso");const t=await(0,r.Y)(s),i=(0,n.Bz)({profile:s.profile??o?.profile}),a=t[i];if(!a)throw new p(`Profile '${i}' could not be found in shared credentials file.`,!1);if(!a.sso_session)throw new p(`Profile '${i}' is missing required property 'sso_session'.`);const c=a.sso_session,l=(await h(s))[c];if(!l)throw new p(`Sso session '${c}' could not be found in shared credentials file.`,!1);for(const e of["sso_start_url","sso_region"])if(!l[e])throw new p(`Sso session '${c}' is missing required property '${e}'.`,!1);l.sso_start_url;const f=l.sso_region;let g;try{g=await(0,S.v)(c)}catch(e){throw new p(`The SSO session token associated with profile=${i} was not found or is invalid. ${C}`,!1)}_("accessToken",g.accessToken),_("expiresAt",g.expiresAt);const{accessToken:w,expiresAt:d}=g,u={token:w,expiration:new Date(d)};if(u.expiration.getTime()-Date.now()>3e5)return u;if(Date.now()-T.getTime()<3e4)return k(u),u;_("clientId",g.clientId,!0),_("clientSecret",g.clientSecret,!0),_("refreshToken",g.refreshToken,!0);try{T.setTime(Date.now());const e=await y(g,f,s);_("accessToken",e.accessToken),_("expiresIn",e.expiresIn);const o=new Date(Date.now()+1e3*e.expiresIn);try{await((e,o)=>{const s=(0,m.C)(e),t=JSON.stringify(o,null,2);return x(s,t)})(c,{...g,accessToken:e.accessToken,expiresAt:o.toISOString(),refreshToken:e.refreshToken})}catch(e){}return{token:e.accessToken,expiration:o}}catch(e){return k(u),u}},N=!1,$=async({ssoStartUrl:e,ssoSession:o,ssoAccountId:n,ssoRegion:r,ssoRoleName:i,ssoClient:a,clientConfig:c,parentClientConfig:l,profile:f,filepath:g,configFilepath:w,ignoreCache:h,logger:u})=>{let p;const C="To refresh this SSO session run aws sso login with the corresponding profile.";if(o)try{const e=await v({profile:f,filepath:g,configFilepath:w,ignoreCache:h})();p={accessToken:e.token,expiresAt:new Date(e.expiration).toISOString()}}catch(e){throw new t.C(e.message,{tryNextLink:N,logger:u})}else try{p=await(0,S.v)(e)}catch(e){throw new t.C(`The SSO session associated with this profile is invalid. ${C}`,{tryNextLink:N,logger:u})}if(new Date(p.expiresAt).getTime()-Date.now()<=0)throw new t.C(`The SSO session associated with this profile has expired. ${C}`,{tryNextLink:N,logger:u});const{accessToken:y}=p,{SSOClient:k,GetRoleCredentialsCommand:_}=await s.e(616).then(s.bind(s,1371)),m=a||new k(Object.assign({},c??{},{logger:c?.logger??l?.logger,region:c?.region??r}));let O;try{O=await m.send(new _({accountId:n,roleName:i,accessToken:y}))}catch(e){throw new t.C(e,{tryNextLink:N,logger:u})}const{roleCredentials:{accessKeyId:x,secretAccessKey:T,sessionToken:$,expiration:I,credentialScope:D,accountId:R}={}}=O;if(!(x&&T&&$&&I))throw new t.C("SSO returns an invalid temporary credential.",{tryNextLink:N,logger:u});const A={accessKeyId:x,secretAccessKey:T,sessionToken:$,expiration:new Date(I),...D&&{credentialScope:D},...R&&{accountId:R}};return o?(0,d.g)(A,"CREDENTIALS_SSO","s"):(0,d.g)(A,"CREDENTIALS_SSO_LEGACY","u"),A},I=(e={})=>async({callerClientConfig:o}={})=>{e.logger?.debug("@aws-sdk/credential-provider-sso - fromSSO");const{ssoStartUrl:s,ssoAccountId:i,ssoRegion:a,ssoRoleName:c,ssoSession:l}=e,{ssoClient:f}=e,g=(0,n.Bz)({profile:e.profile??o?.profile});if(s||i||a||c||l){if(s&&i&&a&&c)return $({ssoStartUrl:s,ssoSession:l,ssoAccountId:i,ssoRegion:a,ssoRoleName:c,ssoClient:f,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:g,filepath:e.filepath,configFilepath:e.configFilepath,ignoreCache:e.ignoreCache,logger:e.logger});throw new t.C('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"',{tryNextLink:!1,logger:e.logger})}{const o=(await(0,r.Y)(e))[g];if(!o)throw new t.C(`Profile ${g} was not found.`,{logger:e.logger});if(!(w=o)||"string"!=typeof w.sso_start_url&&"string"!=typeof w.sso_account_id&&"string"!=typeof w.sso_session&&"string"!=typeof w.sso_region&&"string"!=typeof w.sso_role_name)throw new t.C(`Profile ${g} is not configured with SSO credentials.`,{logger:e.logger});if(o?.sso_session){const n=(await h(e))[o.sso_session],r=` configurations in profile ${g} and sso-session ${o.sso_session}`;if(a&&a!==n.sso_region)throw new t.C("Conflicting SSO region"+r,{tryNextLink:!1,logger:e.logger});if(s&&s!==n.sso_start_url)throw new t.C("Conflicting SSO start_url"+r,{tryNextLink:!1,logger:e.logger});o.sso_region=n.sso_region,o.sso_start_url=n.sso_start_url}const{sso_start_url:n,sso_account_id:i,sso_region:c,sso_role_name:l,sso_session:d}=((e,o)=>{const{sso_start_url:s,sso_account_id:n,sso_region:r,sso_role_name:i}=e;if(!(s&&n&&r&&i))throw new t.C(`Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got ${Object.keys(e).join(", ")}\nReference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html`,{tryNextLink:!1,logger:o});return e})(o,e.logger);return $({ssoStartUrl:n,ssoSession:d,ssoAccountId:i,ssoRegion:c,ssoRoleName:l,ssoClient:f,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:g,filepath:e.filepath,configFilepath:e.configFilepath,ignoreCache:e.ignoreCache,logger:e.logger})}var w}},1363:(e,o,s)=>{s.d(o,{C:()=>i});var t=s(9),n=s(5),r=s(75);const i=e=>{const o=(0,t.createHash)("sha1").update(e).digest("hex");return(0,n.join)((0,r.R)(),".aws","sso","cache",`${o}.json`)}},1365:(e,o,s)=>{s.d(o,{a:()=>i,v:()=>a});var t=s(10),n=s(1363);const{readFile:r}=t.promises,i={},a=async e=>{if(i[e])return i[e];const o=(0,n.C)(e),s=await r(o,"utf8");return JSON.parse(s)}},1364:(e,o,s)=>{s.d(o,{Y:()=>n});var t=s(71);const n=async e=>{const o=await(0,t.p)(e);return((...e)=>{const o={};for(const s of e)for(const[e,t]of Object.entries(s))void 0!==o[e]?Object.assign(o[e],t):o[e]=t;return o})(o.configFile,o.credentialsFile)}}};