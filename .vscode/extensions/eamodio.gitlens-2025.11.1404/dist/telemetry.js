exports.id=240,exports.ids=[240],exports.modules={9448:(e,t,r)=>{r.r(t),r.d(t,{OpenTelemetryProvider:()=>OpenTelemetryProvider}),(E=v||(v={}))[E.INTERNAL=0]="INTERNAL",E[E.SERVER=1]="SERVER",E[E.CLIENT=2]="CLIENT",E[E.PRODUCER=3]="PRODUCER",E[E.CONSUMER=4]="CONSUMER";let OTLPExporterBase=class OTLPExporterBase{_delegate;constructor(e){this._delegate=e}export(e,t){this._delegate.export(e,t)}forceFlush(){return this._delegate.forceFlush()}shutdown(){return this._delegate.shutdown()}};function n(e){return Object.keys(e).map(t=>(function e(t,r){return{key:t,value:function t(r){let n=typeof r;return"string"===n?{stringValue:r}:"number"===n?Number.isInteger(r)?{intValue:r}:{doubleValue:r}:"boolean"===n?{boolValue:r}:r instanceof Uint8Array?{bytesValue:r}:Array.isArray(r)?{arrayValue:{values:r.map(t)}}:"object"===n&&null!=r?{kvlistValue:{values:Object.entries(r).map(([t,r])=>e(t,r))}}:{}}(r)}})(t,e[t]))}let i=r(2987).performance;function s(e){return[Math.trunc(e/1e3),Math.round(e%1e3*1e6)]}function o(){let e=i.timeOrigin;return"number"!=typeof e&&(e=i.timing&&i.timing.fetchStart),e}function a(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}function u(e){return a(e)||"number"==typeof e||e instanceof Date}function l(e,t){let r=[e[0]+t[0],e[1]+t[1]];return r[1]>=1e9&&(r[1]-=1e9,r[0]+=1),r}function c(e){return e>=48&&e<=57?e-48:e>=97&&e<=102?e-87:e-55}function p(e){let t=new Uint8Array(e.length/2),r=0;for(let n=0;n<e.length;n+=2){let i=c(e.charCodeAt(n)),s=c(e.charCodeAt(n+1));t[r++]=i<<4|s}return t}function d(e){let t=BigInt(1e9);return BigInt(Math.trunc(e[0]))*t+BigInt(Math.trunc(e[1]))}function h(e){var t;return{low:Number(BigInt.asUintN(32,t=d(e))),high:Number(BigInt.asUintN(32,t>>BigInt(32)))}}let f="undefined"!=typeof BigInt?function(e){return d(e).toString()}:function(e){return 1e9*e[0]+e[1]};function m(e){return e}function _(e){if(void 0!==e)return p(e)}let g={encodeHrTime:h,encodeSpanContext:p,encodeOptionalSpanContext:_};function S(e,t){let r=255&e|256;return t&&(r|=512),r}let y={serializeRequest:e=>{let t={resourceSpans:function(e,t){let r=function(e){let t=new Map;for(let r of e){let e=t.get(r.resource);e||(e=new Map,t.set(r.resource,e));let n=`${r.instrumentationScope.name}@${r.instrumentationScope.version||""}:${r.instrumentationScope.schemaUrl||""}`,i=e.get(n);i||(i=[],e.set(n,i)),i.push(r)}return t}(e),i=[],s=r.entries(),o=s.next();for(;!o.done;){let[e,r]=o.value,u=[],l=r.values(),c=l.next();for(;!c.done;){let e=c.value;if(e.length>0){var a;let r=e.map(e=>(function(e,t){let r=e.spanContext(),i=e.status,s=e.parentSpanContext?.spanId?t.encodeSpanContext(e.parentSpanContext?.spanId):void 0;return{traceId:t.encodeSpanContext(r.traceId),spanId:t.encodeSpanContext(r.spanId),parentSpanId:s,traceState:r.traceState?.serialize(),name:e.name,kind:null==e.kind?0:e.kind+1,startTimeUnixNano:t.encodeHrTime(e.startTime),endTimeUnixNano:t.encodeHrTime(e.endTime),attributes:n(e.attributes),droppedAttributesCount:e.droppedAttributesCount,events:e.events.map(e=>{var r,i;return r=e,i=t,{attributes:r.attributes?n(r.attributes):[],name:r.name,timeUnixNano:i.encodeHrTime(r.time),droppedAttributesCount:r.droppedAttributesCount||0}}),droppedEventsCount:e.droppedEventsCount,status:{code:i.code,message:i.message},links:e.links.map(e=>{var r,i;return r=e,i=t,{attributes:r.attributes?n(r.attributes):[],spanId:i.encodeSpanContext(r.context.spanId),traceId:i.encodeSpanContext(r.context.traceId),traceState:r.context.traceState?.serialize(),droppedAttributesCount:r.droppedAttributesCount||0,flags:S(r.context.traceFlags,r.context.isRemote)}}),droppedLinksCount:e.droppedLinksCount,flags:S(r.traceFlags,e.parentSpanContext?.isRemote)}})(e,t));u.push({scope:{name:(a=e[0].instrumentationScope).name,version:a.version},spans:r,schemaUrl:e[0].instrumentationScope.schemaUrl})}c=l.next()}let p=function(e){let t={attributes:n(e.attributes),droppedAttributesCount:0},r=e.schemaUrl;return r&&""!==r&&(t.schemaUrl=r),t}(e),d={resource:p,scopeSpans:u,schemaUrl:p.schemaUrl};i.push(d),o=s.next()}return i}(e,function(e){if(void 0===e)return g;let t=e.useLongBits??!0,r=e.useHex??!1;return{encodeHrTime:t?h:f,encodeSpanContext:r?m:p,encodeOptionalSpanContext:r?m:_}}({useHex:!0,useLongBits:!1}))};return new TextEncoder().encode(JSON.stringify(t))},deserializeResponse:e=>0===e.length?{}:JSON.parse(new TextDecoder().decode(e))};(C=T||(T={}))[C.SUCCESS=0]="SUCCESS",C[C.FAILED=1]="FAILED";let OTLPExporterError=class OTLPExporterError extends Error{code;name="OTLPExporterError";data;constructor(e,t,r){super(e),this.data=r,this.code=t}};var E,v,T,b,w,O,L,P,A,x,C,R,I,N,U,D,M,B,k,F="object"==typeof globalThis?globalThis:global,j="1.9.0",$=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/,z=function(e){var t=new Set([e]),r=new Set,n=e.match($);if(!n)return function(){return!1};var i={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(null!=i.prerelease)return function(t){return t===e};function s(e){return r.add(e),!1}return function(e){if(t.has(e))return!0;if(r.has(e))return!1;var n=e.match($);if(!n)return s(e);var o={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(null!=o.prerelease||i.major!==o.major)return s(e);if(0===i.major)return i.minor===o.minor&&i.patch<=o.patch?(t.add(e),!0):s(e);return i.minor<=o.minor?(t.add(e),!0):s(e)}}(j),V=Symbol.for("opentelemetry.js.api."+j.split(".")[0]);function H(e,t,r,n){void 0===n&&(n=!1);var i,s=F[V]=null!=(i=F[V])?i:{version:j};if(!n&&s[e]){var o=Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(o.stack||o.message),!1}if(s.version!==j){var o=Error("@opentelemetry/api: Registration of version v"+s.version+" for "+e+" does not match previously registered API v"+j);return r.error(o.stack||o.message),!1}return s[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+j+"."),!0}function G(e){var t,r,n=null==(t=F[V])?void 0:t.version;if(n&&z(n))return null==(r=F[V])?void 0:r[e]}function Q(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+j+".");var r=F[V];r&&delete r[e]}var X=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o},K=function(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},J=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return W("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return W("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return W("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return W("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return W("verbose",this._namespace,e)},e}();function W(e,t,r){var n=G("diag");if(n)return r.unshift(t),n[e].apply(n,K([],X(r),!1))}(R=b||(b={}))[R.NONE=0]="NONE",R[R.ERROR=30]="ERROR",R[R.WARN=50]="WARN",R[R.INFO=60]="INFO",R[R.DEBUG=70]="DEBUG",R[R.VERBOSE=80]="VERBOSE",R[R.ALL=9999]="ALL";var Y=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o},q=function(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},Z=function(){function e(){function e(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=G("diag");if(n)return n[e].apply(n,q([],Y(t),!1))}}var t=this;t.setLogger=function(e,r){if(void 0===r&&(r={logLevel:b.INFO}),e===t){var n,i,s,o=Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!=(n=o.stack)?n:o.message),!1}"number"==typeof r&&(r={logLevel:r});var a=G("diag"),u=function(e,t){function r(r,n){var i=t[r];return"function"==typeof i&&e>=n?i.bind(t):function(){}}return e<b.NONE?e=b.NONE:e>b.ALL&&(e=b.ALL),t=t||{},{error:r("error",b.ERROR),warn:r("warn",b.WARN),info:r("info",b.INFO),debug:r("debug",b.DEBUG),verbose:r("verbose",b.VERBOSE)}}(null!=(i=r.logLevel)?i:b.INFO,e);if(a&&!r.suppressOverrideMessage){var l=null!=(s=Error().stack)?s:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+l),u.warn("Current logger will overwrite one already registered from "+l)}return H("diag",u,t,!0)},t.disable=function(){Q("diag",t)},t.createComponentLogger=function(e){return new J(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),ee=Z.instance();let OTLPExportDelegate=class OTLPExportDelegate{_transport;_serializer;_responseHandler;_promiseQueue;_timeout;_diagLogger;constructor(e,t,r,n,i){this._transport=e,this._serializer=t,this._responseHandler=r,this._promiseQueue=n,this._timeout=i,this._diagLogger=ee.createComponentLogger({namespace:"OTLPExportDelegate"})}export(e,t){if(this._diagLogger.debug("items to be sent",e),this._promiseQueue.hasReachedLimit())return void t({code:T.FAILED,error:Error("Concurrent export limit reached")});let r=this._serializer.serializeRequest(e);null==r?t({code:T.FAILED,error:Error("Nothing to send")}):this._promiseQueue.pushPromise(this._transport.send(r,this._timeout).then(e=>{if("success"===e.status){if(null!=e.data)try{this._responseHandler.handleResponse(this._serializer.deserializeResponse(e.data))}catch(t){this._diagLogger.warn("Export succeeded but could not deserialize response - is the response specification compliant?",t,e.data)}t({code:T.SUCCESS});return}"failure"===e.status&&e.error?t({code:T.FAILED,error:e.error}):"retryable"===e.status?t({code:T.FAILED,error:new OTLPExporterError("Export failed with retryable status")}):t({code:T.FAILED,error:new OTLPExporterError("Export failed with unknown error")})},e=>t({code:T.FAILED,error:e})))}forceFlush(){return this._promiseQueue.awaitAll()}async shutdown(){this._diagLogger.debug("shutdown started"),await this.forceFlush(),this._transport.shutdown()}};var et=r(3106),er=r(2203);let en="OTel-OTLP-Exporter-JavaScript/0.207.0";let HttpExporterTransport=class HttpExporterTransport{_parameters;_utils=null;constructor(e){this._parameters=e}async send(e,t){let{agent:r,request:n}=await this._loadUtils();return new Promise(i=>{var s,o,a,u,l,c,p;let d,h,f,m,_;s=this._parameters,o=e=>{i(e)},d=new URL(s.url),h={...s.headers()},s.userAgent?h["User-Agent"]=`${s.userAgent} ${en}`:h["User-Agent"]=en,(f=n({hostname:d.hostname,port:d.port,path:d.pathname,method:"POST",headers:h,agent:r},e=>{let t=[];e.on("data",e=>t.push(e)),e.on("end",()=>{e.statusCode&&e.statusCode<299?o({status:"success",data:Buffer.concat(t)}):e.statusCode&&[429,502,503,504].includes(e.statusCode)?o({status:"retryable",retryInMillis:function(e){if(null==e)return;let t=Number.parseInt(e,10);if(Number.isInteger(t))return t>0?1e3*t:-1;let r=new Date(e).getTime()-Date.now();return r>=0?r:0}(e.headers["retry-after"])}):o({status:"failure",error:new OTLPExporterError(e.statusMessage,e.statusCode,Buffer.concat(t).toString())})})})).setTimeout(t,()=>{f.destroy(),o({status:"failure",error:Error("Request Timeout")})}),f.on("error",e=>{o({status:"failure",error:e})}),a=f,u=s.compression,l=e,c=e=>{o({status:"failure",error:e})},_=(p=l,(m=new er.Readable).push(p),m.push(null),m),"gzip"===u&&(a.setHeader("Content-Encoding","gzip"),_=_.on("error",c).pipe(et.createGzip()).on("error",c)),_.pipe(a).on("error",c)})}shutdown(){}async _loadUtils(){let e=this._utils;if(null===e){let t=new URL(this._parameters.url).protocol,[r,n]=await Promise.all([this._parameters.agentFactory(t),ei(t)]);e=this._utils={agent:r,request:n}}return e}};async function ei(e){let t="http:"===e?Promise.resolve().then(r.t.bind(r,8611,23)):Promise.resolve().then(r.t.bind(r,5692,23)),{request:n}=await t;return n}let BoundedQueueExportPromiseHandler=class BoundedQueueExportPromiseHandler{_concurrencyLimit;_sendingPromises=[];constructor(e){this._concurrencyLimit=e}pushPromise(e){if(this.hasReachedLimit())throw Error("Concurrency Limit reached");this._sendingPromises.push(e);let t=()=>{let t=this._sendingPromises.indexOf(e);this._sendingPromises.splice(t,1)};e.then(t,t)}hasReachedLimit(){return this._sendingPromises.length>=this._concurrencyLimit}async awaitAll(){await Promise.all(this._sendingPromises)}};let RetryingTransport=class RetryingTransport{_transport;constructor(e){this._transport=e}retry(e,t,r){return new Promise((n,i)=>{setTimeout(()=>{this._transport.send(e,t).then(n,i)},r)})}async send(e,t){let r=Date.now()+t,n=await this._transport.send(e,t),i=5,s=1e3;for(;"retryable"===n.status&&i>0;){i--;let t=Math.max(Math.min(s,5e3)+(.4*Math.random()-.2),0);s*=1.5;let o=n.retryInMillis??t,a=r-Date.now();if(o>a)break;n=await this.retry(e,a,o)}return n}shutdown(){return this._transport.shutdown()}};function es(e){if(null!=e)return()=>e}function eo(e){return async t=>{let n="http:"===t,i=n?Promise.resolve().then(r.t.bind(r,8611,23)):Promise.resolve().then(r.t.bind(r,5692,23)),{Agent:s}=await i;if(n){let{ca:t,cert:r,key:n,...i}=e;return new s(i)}return new s(e)}}var ea=r(9896),eu=r(6928),el=r(9023);function ec(e){let t=process.env[e];if(null==t||""===t.trim())return;let r=Number(t);return isNaN(r)?void ee.warn(`Unknown value ${(0,el.inspect)(t)} for ${e}, expected a number, using defaults`):r}function ep(e){let t=process.env[e];if(null!=t&&""!==t.trim())return t}var ed=Symbol("BaggageEntryMetadata"),eh=Z.instance();function ef(e){let t={};return"string"==typeof e&&e.length>0&&e.split(",").forEach(e=>{let r=function(e){var t;let r,n=e.split(";");if(n.length<=0)return;let i=n.shift();if(!i)return;let s=i.indexOf("=");if(s<=0)return;let o=decodeURIComponent(i.substring(0,s).trim()),a=decodeURIComponent(i.substring(s+1).trim());return n.length>0&&("string"!=typeof(t=n.join(";"))&&(eh.error("Cannot create baggage metadata from unknown type: "+typeof t),t=""),r={__TYPE__:ed,toString:function(){return t}}),{key:o,value:a,metadata:r}}(e);void 0!==r&&r.value.length>0&&(t[r.key]=r.value)}),t}function em(e){let t=ec(e);if(null!=t){if(Number.isFinite(t)&&t>0)return t;ee.warn(`Configuration: ${e} is invalid, expected number greater than 0 (actual: ${t})`)}}function e_(e){let t=ep(e)?.trim();if(null==t||"none"===t||"gzip"===t)return t;ee.warn(`Configuration: ${e} is invalid, expected 'none' or 'gzip' (actual: '${t}')`)}function eg(e,t,r){let n=ep(e),i=ep(t),s=n??i;if(null!=s)try{return ea.readFileSync(eu.resolve(process.cwd(),s))}catch{ee.warn(r);return}}let OTLPTraceExporter=class OTLPTraceExporter extends OTLPExporterBase{constructor(e={}){var t,r,n,i,s,o,a,u,l,c,p,d,h;let f,m,_,g,S,E;super((c=(t="v1/traces",r={"Content-Type":"application/json"},e.metadata&&ee.warn("Metadata cannot be set when using http"),i={url:e.url,headers:es(e.headers),concurrencyLimit:e.concurrencyLimit,timeoutMillis:e.timeoutMillis,compression:e.compression,agentFactory:function(e){if("function"==typeof e.httpAgentOptions)return e.httpAgentOptions;let t=e.httpAgentOptions;return(null!=e.keepAlive&&(t={keepAlive:e.keepAlive,...t}),null!=t)?eo(t):void 0}(e),userAgent:e.userAgent},s={...{timeoutMillis:(n="TRACES",f=em(`OTEL_EXPORTER_OTLP_${n}_TIMEOUT`),m=em("OTEL_EXPORTER_OTLP_TIMEOUT"),f??m),compression:(_=e_(`OTEL_EXPORTER_OTLP_${n}_COMPRESSION`),g=e_("OTEL_EXPORTER_OTLP_COMPRESSION"),_??g)},url:function(e){let t=ep(`OTEL_EXPORTER_OTLP_${e}_ENDPOINT`);if(void 0!==t)try{return new URL(t).toString()}catch{ee.warn(`Configuration: Could not parse environment-provided export URL: '${t}', falling back to undefined`);return}}(n)??function(e){let t=ep("OTEL_EXPORTER_OTLP_ENDPOINT");if(void 0!==t){var r=t;try{new URL(r)}catch{ee.warn(`Configuration: Could not parse environment-provided export URL: '${r}', falling back to undefined`);return}r.endsWith("/")||(r+="/"),r+=e;try{new URL(r)}catch{ee.warn(`Configuration: Provided URL appended with '${e}' is not a valid URL, using 'undefined' instead of '${r}'`);return}return r}}(t),headers:es(function(e){let t=ep(`OTEL_EXPORTER_OTLP_${e}_HEADERS`),r=ep("OTEL_EXPORTER_OTLP_HEADERS"),n=ef(t),i=ef(r);if(0!==Object.keys(n).length||0!==Object.keys(i).length)return Object.assign({},ef(r),ef(t))}(n)),agentFactory:eo({keepAlive:!0,ca:eg(`OTEL_EXPORTER_OTLP_${n}_CERTIFICATE`,"OTEL_EXPORTER_OTLP_CERTIFICATE","Failed to read root certificate file"),cert:eg(`OTEL_EXPORTER_OTLP_${n}_CLIENT_CERTIFICATE`,"OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE","Failed to read client certificate chain file"),key:eg(`OTEL_EXPORTER_OTLP_${n}_CLIENT_KEY`,"OTEL_EXPORTER_OTLP_CLIENT_KEY","Failed to read client certificate private key file")})},{...(o={...{timeoutMillis:1e4,concurrencyLimit:30,compression:"none",headers:()=>r,url:"http://localhost:4318/"+t},agentFactory:eo({keepAlive:!0})},{...{timeoutMillis:function(e){if(Number.isFinite(e)&&e>0)return e;throw Error(`Configuration: timeoutMillis is invalid, expected number greater than 0 (actual: '${e}')`)}(i.timeoutMillis??s.timeoutMillis??o.timeoutMillis),concurrencyLimit:i.concurrencyLimit??s.concurrencyLimit??o.concurrencyLimit,compression:i.compression??s.compression??o.compression},headers:(a=i.headers,u=()=>{let e={};return Object.entries(a?.()??{}).forEach(([t,r])=>{void 0!==r?e[t]=String(r):ee.warn(`Header "${t}" has invalid value (${r}) and will be ignored`)}),e},l=s.headers,S={...(0,o.headers)()},E={},()=>(null!=l&&Object.assign(E,l()),null!=u&&Object.assign(E,u()),Object.assign(E,S))),url:function(e){if(null!=e)try{let t=globalThis.location?.href;return new URL(e,t).href}catch{throw Error(`Configuration: Could not parse user-provided export URL: '${e}'`)}}(i.url)??s.url??o.url}),agentFactory:i.agentFactory??s.agentFactory??o.agentFactory,userAgent:i.userAgent}),p=y,d={transport:new RetryingTransport({transport:new HttpExporterTransport(c)}.transport),serializer:p,promiseHandler:new BoundedQueueExportPromiseHandler(c.concurrencyLimit)},h={timeout:c.timeoutMillis},new OTLPExportDelegate(d.transport,d.serializer,{handleResponse(e){null!=e&&Object.prototype.hasOwnProperty.call(e,"partialSuccess")&&null!=e.partialSuccess&&0!==Object.keys(e.partialSuccess).length&&ee.warn("Received Partial Success response:",JSON.stringify(e.partialSuccess))}},d.promiseHandler,h.timeout)))}};let eS="exception.message",ey="exception.type",eE="service.name",ev="telemetry.sdk.language",eT="telemetry.sdk.name",eb="telemetry.sdk.version",ew={[eT]:"opentelemetry","process.runtime.name":"node",[ev]:"nodejs",[eb]:"2.2.0"},eO=e=>null!==e&&"object"==typeof e&&"function"==typeof e.then;let ResourceImpl=class ResourceImpl{_rawAttributes;_asyncAttributesPending=!1;_schemaUrl;_memoizedAttributes;static FromAttributeList(e,t){let r=new ResourceImpl({},t);return r._rawAttributes=eP(e),r._asyncAttributesPending=e.filter(([e,t])=>eO(t)).length>0,r}constructor(e,t){const r=e.attributes??{};this._rawAttributes=Object.entries(r).map(([e,t])=>(eO(t)&&(this._asyncAttributesPending=!0),[e,t])),this._rawAttributes=eP(this._rawAttributes),this._schemaUrl=function(e){if("string"==typeof e||void 0===e)return e;ee.warn("Schema URL must be string or undefined, got %s. Schema URL will be ignored.",e)}(t?.schemaUrl)}get asyncAttributesPending(){return this._asyncAttributesPending}async waitForAsyncAttributes(){if(this.asyncAttributesPending){for(let e=0;e<this._rawAttributes.length;e++){let[t,r]=this._rawAttributes[e];this._rawAttributes[e]=[t,eO(r)?await r:r]}this._asyncAttributesPending=!1}}get attributes(){if(this.asyncAttributesPending&&ee.error("Accessing resource attributes before async attributes settled"),this._memoizedAttributes)return this._memoizedAttributes;let e={};for(let[t,r]of this._rawAttributes){if(eO(r)){ee.debug(`Unsettled resource attribute ${t} skipped`);continue}null!=r&&(e[t]??=r)}return this._asyncAttributesPending||(this._memoizedAttributes=e),e}getRawAttributes(){return this._rawAttributes}get schemaUrl(){return this._schemaUrl}merge(e){var t,r;let n,i,s;if(null==e)return this;let o=(t=this,r=e,n=t?.schemaUrl,s=void 0===(i=r?.schemaUrl)||""===i,void 0===n||""===n?i:s||n===i?n:void ee.warn('Schema URL merge conflict: old resource has "%s", updating resource has "%s". Resulting resource will have undefined Schema URL.',n,i));return ResourceImpl.FromAttributeList([...e.getRawAttributes(),...this.getRawAttributes()],o?{schemaUrl:o}:void 0)}};function eL(e,t){return ResourceImpl.FromAttributeList(Object.entries(e),t)}function eP(e){return e.map(([e,t])=>eO(t)?[e,t.catch(t=>{ee.debug("promise rejection for resource attribute: %s - %s",e,t)})]:[e,t])}(I=w||(w={}))[I.NONE=0]="NONE",I[I.SAMPLED=1]="SAMPLED";let Deferred=class Deferred{_promise;_resolve;_reject;constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}get promise(){return this._promise}resolve(e){this._resolve(e)}reject(e){this._reject(e)}};let BindOnceFuture=class BindOnceFuture{_callback;_that;_isCalled=!1;_deferred=new Deferred;constructor(e,t){this._callback=e,this._that=t}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...e){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...e)).then(e=>this._deferred.resolve(e),e=>this._deferred.reject(e))}catch(e){this._deferred.reject(e)}}return this._deferred.promise}};function eA(e){try{var t;ee.error((t=e,"string"==typeof t?t:JSON.stringify(function(e){let t={},r=e;for(;null!==r;)Object.getOwnPropertyNames(r).forEach(e=>{if(t[e])return;let n=r[e];n&&(t[e]=String(n))}),r=Object.getPrototypeOf(r);return t}(t))))}catch{}}function ex(e){return Symbol.for(e)}var eC=new function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(e){return r._currentContext.get(e)},r.setValue=function(t,n){var i=new e(r._currentContext);return i._currentContext.set(t,n),i},r.deleteValue=function(t){var n=new e(r._currentContext);return n._currentContext.delete(t),n}},eR=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o},eI=function(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},eN=function(){function e(){}return e.prototype.active=function(){return eC},e.prototype.with=function(e,t,r){for(var n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];return t.call.apply(t,eI([r],eR(n),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),eU=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return o},eD=function(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},eM="context",eB=new eN,ek=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return H(eM,e,Z.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,r){for(var n,i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];return(n=this._getContextManager()).with.apply(n,eD([e,t,r],eU(i),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return G(eM)||eB},e.prototype.disable=function(){this._getContextManager().disable(),Q(eM,Z.instance())},e}(),eF=ek.getInstance();let ej=ex("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function e$(e){return e.setValue(ej,!0)}let SimpleSpanProcessor=class SimpleSpanProcessor{_exporter;_shutdownOnce;_pendingExports;constructor(e){this._exporter=e,this._shutdownOnce=new BindOnceFuture(this._shutdown,this),this._pendingExports=new Set}async forceFlush(){await Promise.all(Array.from(this._pendingExports)),this._exporter.forceFlush&&await this._exporter.forceFlush()}onStart(e,t){}onEnd(e){if(this._shutdownOnce.isCalled||(e.spanContext().traceFlags&w.SAMPLED)==0)return;let t=this._doExport(e).catch(e=>eA(e));this._pendingExports.add(t),t.finally(()=>this._pendingExports.delete(t))}async _doExport(e){var t,r;e.resource.asyncAttributesPending&&await e.resource.waitForAsyncAttributes?.();let n=await (t=this._exporter,r=[e],new Promise(e=>{eF.with(e$(eF.active()),()=>{t.export(r,t=>{e(t)})})}));if(n.code!==T.SUCCESS)throw n.error??Error(`SimpleSpanProcessor: span export failed (status ${n})`)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return this._exporter.shutdown()}};let BatchSpanProcessorBase=class BatchSpanProcessorBase{_exporter;_maxExportBatchSize;_maxQueueSize;_scheduledDelayMillis;_exportTimeoutMillis;_isExporting=!1;_finishedSpans=[];_timer;_shutdownOnce;_droppedSpansCount=0;constructor(e,t){this._exporter=e,this._maxExportBatchSize="number"==typeof t?.maxExportBatchSize?t.maxExportBatchSize:ec("OTEL_BSP_MAX_EXPORT_BATCH_SIZE")??512,this._maxQueueSize="number"==typeof t?.maxQueueSize?t.maxQueueSize:ec("OTEL_BSP_MAX_QUEUE_SIZE")??2048,this._scheduledDelayMillis="number"==typeof t?.scheduledDelayMillis?t.scheduledDelayMillis:ec("OTEL_BSP_SCHEDULE_DELAY")??5e3,this._exportTimeoutMillis="number"==typeof t?.exportTimeoutMillis?t.exportTimeoutMillis:ec("OTEL_BSP_EXPORT_TIMEOUT")??3e4,this._shutdownOnce=new BindOnceFuture(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(ee.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}onStart(e,t){}onEnd(e){this._shutdownOnce.isCalled||(e.spanContext().traceFlags&w.SAMPLED)!=0&&this._addToBuffer(e)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Promise.resolve().then(()=>this.onShutdown()).then(()=>this._flushAll()).then(()=>this._exporter.shutdown())}_addToBuffer(e){if(this._finishedSpans.length>=this._maxQueueSize){0===this._droppedSpansCount&&ee.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(ee.warn(`Dropped ${this._droppedSpansCount} spans because maxQueueSize reached`),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()}_flushAll(){return new Promise((e,t)=>{let r=[],n=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);for(let e=0;e<n;e++)r.push(this._flushOneBatch());Promise.all(r).then(()=>{e()}).catch(t)})}_flushOneBatch(){return(this._clearTimer(),0===this._finishedSpans.length)?Promise.resolve():new Promise((e,t)=>{let r=setTimeout(()=>{t(Error("Timeout"))},this._exportTimeoutMillis);eF.with(e$(eF.active()),()=>{let n;this._finishedSpans.length<=this._maxExportBatchSize?(n=this._finishedSpans,this._finishedSpans=[]):n=this._finishedSpans.splice(0,this._maxExportBatchSize);let i=()=>this._exporter.export(n,n=>{clearTimeout(r),n.code===T.SUCCESS?e():t(n.error??Error("BatchSpanProcessor: span export failed"))}),s=null;for(let e=0,t=n.length;e<t;e++){let t=n[e];t.resource.asyncAttributesPending&&t.resource.waitForAsyncAttributes&&(s??=[]).push(t.resource.waitForAsyncAttributes())}null===s?i():Promise.all(s).then(i,e=>{eA(e),t(e)})})})}_maybeStartTimer(){if(this._isExporting)return;let e=()=>{this._isExporting=!0,this._flushOneBatch().finally(()=>{this._isExporting=!1,this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())}).catch(e=>{this._isExporting=!1,eA(e)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return e();void 0===this._timer&&(this._timer=setTimeout(()=>e(),this._scheduledDelayMillis),"number"!=typeof this._timer&&this._timer.unref())}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}};let BatchSpanProcessor=class BatchSpanProcessor extends BatchSpanProcessorBase{onShutdown(){}};let ez=Function.prototype.toString,eV=ez.call(Object),eH=Object.getPrototypeOf,eG=Object.prototype,eQ=eG.hasOwnProperty,eX=Symbol?Symbol.toStringTag:void 0,eK=eG.toString;function eJ(e){var t,r,n;if(null==(t=e)||"object"!=typeof t||"[object Object]"!==(null==(r=e)?void 0===r?"[object Undefined]":"[object Null]":eX&&eX in Object(r)?function(e){let t=eQ.call(e,eX),r=e[eX],n=!1;try{e[eX]=void 0,n=!0}catch{}let i=eK.call(e);return n&&(t?e[eX]=r:delete e[eX]),i}(r):(n=r,eK.call(n))))return!1;let i=eH(e);if(null===i)return!0;let s=eQ.call(i,"constructor")&&i.constructor;return"function"==typeof s&&s instanceof s&&ez.call(s)===eV}function eW(e){return eq(e)?e.slice():e}function eY(e,t,r){let n=r.get(e[t])||[];for(let r=0,i=n.length;r<i;r++){let i=n[r];if(i.key===t&&i.obj===e)return!0}return!1}function eq(e){return Array.isArray(e)}function eZ(e){return"function"==typeof e}function e0(e){return!e1(e)&&!eq(e)&&!eZ(e)&&"object"==typeof e}function e1(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||void 0===e||e instanceof Date||e instanceof RegExp||null===e}var e2="0000000000000000",e3="00000000000000000000000000000000",e8={traceId:e3,spanId:e2,traceFlags:w.NONE},e9=function(){function e(e){void 0===e&&(e=e8),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),e4=ex("OpenTelemetry Context Key SPAN");function e5(e){return e.getValue(e4)||void 0}function e6(){return e5(ek.getInstance().active())}function e7(e,t){return e.setValue(e4,t)}function te(e){return e.deleteValue(e4)}function tt(e,t){return e7(e,new e9(t))}function tr(e){var t;return null==(t=e5(e))?void 0:t.spanContext()}var tn=/^([0-9a-f]{32})$/i,ti=/^[0-9a-f]{16}$/i;function ts(e){return tn.test(e)&&e!==e3}function to(e){var t;return ts(e.traceId)&&(t=e.spanId,ti.test(t)&&t!==e2)}function ta(e){return new e9(e)}var tu=ek.getInstance(),tl=function(){function e(){}return e.prototype.startSpan=function(e,t,r){if(void 0===r&&(r=tu.active()),null==t?void 0:t.root)return new e9;var n,i=r&&tr(r);return"object"==typeof(n=i)&&"string"==typeof n.spanId&&"string"==typeof n.traceId&&"number"==typeof n.traceFlags&&to(i)?new e9(i):new e9},e.prototype.startActiveSpan=function(e,t,r,n){if(!(arguments.length<2)){2==arguments.length?o=t:3==arguments.length?(i=t,o=r):(i=t,s=r,o=n);var i,s,o,a=null!=s?s:tu.active(),u=this.startSpan(e,i,a),l=e7(a,u);return tu.with(l,o,void 0,u)}},e}(),tc=new tl,tp=function(){function e(e,t,r,n){this._provider=e,this.name=t,this.version=r,this.options=n}return e.prototype.startSpan=function(e,t,r){return this._getTracer().startSpan(e,t,r)},e.prototype.startActiveSpan=function(e,t,r,n){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):tc},e}(),td=new(function(){function e(){}return e.prototype.getTracer=function(e,t,r){return new tl},e}()),th=function(){function e(){}return e.prototype.getTracer=function(e,t,r){var n;return null!=(n=this.getDelegateTracer(e,t,r))?n:new tp(this,e,t,r)},e.prototype.getDelegate=function(){var e;return null!=(e=this._delegate)?e:td},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,r){var n;return null==(n=this._delegate)?void 0:n.getTracer(e,t,r)},e}(),tf="trace",tm=(function(){function e(){this._proxyTracerProvider=new th,this.wrapSpanContext=ta,this.isSpanContextValid=to,this.deleteSpan=te,this.getSpan=e5,this.getActiveSpan=e6,this.getSpanContext=tr,this.setSpan=e7,this.setSpanContext=tt}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=H(tf,this._proxyTracerProvider,Z.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return G(tf)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){Q(tf,Z.instance()),this._proxyTracerProvider=new th},e})().getInstance();function t_(e){let t={};if("object"!=typeof e||null==e)return t;for(let n in e){var r;if(!Object.prototype.hasOwnProperty.call(e,n))continue;if("string"!=typeof(r=n)||""===r){ee.warn(`Invalid attribute key: ${n}`);continue}let i=e[n];if(!tg(i)){ee.warn(`Invalid attribute value set for key: ${n}`);continue}Array.isArray(i)?t[n]=i.slice():t[n]=i}return t}function tg(e){return null==e||(Array.isArray(e)?function(e){let t;for(let r of e){if(null==r)continue;let e=typeof r;if(e!==t){if(!t&&tS(e)){t=e;continue}return!1}}return!0}(e):tS(typeof e))}function tS(e){switch(e){case"number":case"boolean":case"string":return!0}return!1}(N=O||(O={}))[N.NOT_RECORD=0]="NOT_RECORD",N[N.RECORD=1]="RECORD",N[N.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED",(U=L||(L={}))[U.UNSET=0]="UNSET",U[U.OK=1]="OK",U[U.ERROR=2]="ERROR";let SpanImpl=class SpanImpl{_spanContext;kind;parentSpanContext;attributes={};links=[];events=[];startTime;resource;instrumentationScope;_droppedAttributesCount=0;_droppedEventsCount=0;_droppedLinksCount=0;name;status={code:L.UNSET};endTime=[0,0];_ended=!1;_duration=[-1,-1];_spanProcessor;_spanLimits;_attributeValueLengthLimit;_performanceStartTime;_performanceOffset;_startTimeProvided;constructor(e){const t=Date.now();this._spanContext=e.spanContext,this._performanceStartTime=i.now(),this._performanceOffset=t-(this._performanceStartTime+o()),this._startTimeProvided=null!=e.startTime,this._spanLimits=e.spanLimits,this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,this._spanProcessor=e.spanProcessor,this.name=e.name,this.parentSpanContext=e.parentSpanContext,this.kind=e.kind,this.links=e.links||[],this.startTime=this._getTime(e.startTime??t),this.resource=e.resource,this.instrumentationScope=e.scope,null!=e.attributes&&this.setAttributes(e.attributes),this._spanProcessor.onStart(this,e.context)}spanContext(){return this._spanContext}setAttribute(e,t){if(null==t||this._isSpanEnded())return this;if(0===e.length)return ee.warn(`Invalid attribute key: ${e}`),this;if(!tg(t))return ee.warn(`Invalid attribute value set for key: ${e}`),this;let{attributeCountLimit:r}=this._spanLimits;return void 0!==r&&Object.keys(this.attributes).length>=r&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?this._droppedAttributesCount++:this.attributes[e]=this._truncateToSize(t),this}setAttributes(e){for(let[t,r]of Object.entries(e))this.setAttribute(t,r);return this}addEvent(e,t,r){if(this._isSpanEnded())return this;let{eventCountLimit:n}=this._spanLimits;if(0===n)return ee.warn("No events allowed."),this._droppedEventsCount++,this;void 0!==n&&this.events.length>=n&&(0===this._droppedEventsCount&&ee.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),u(t)&&(u(r)||(r=t),t=void 0);let i=t_(t);return this.events.push({name:e,attributes:i,time:this._getTime(r),droppedAttributesCount:0}),this}addLink(e){return this.links.push(e),this}addLinks(e){return this.links.push(...e),this}setStatus(e){return this._isSpanEnded()||(this.status={...e},null!=this.status.message&&"string"!=typeof e.message&&(ee.warn(`Dropping invalid status.message of type '${typeof e.message}', expected 'string'`),delete this.status.message)),this}updateName(e){return this._isSpanEnded()||(this.name=e),this}end(e){var t,r;let n,i;this._isSpanEnded()?ee.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`):(this._ended=!0,this.endTime=this._getTime(e),this._duration=(t=this.startTime,n=(r=this.endTime)[0]-t[0],(i=r[1]-t[1])<0&&(n-=1,i+=1e9),[n,i]),this._duration[0]<0&&(ee.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&ee.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this))}_getTime(e){if("number"==typeof e&&e<=i.now()){var t;return t=e+this._performanceOffset,l(s(o()),s("number"==typeof t?t:i.now()))}if("number"==typeof e)return s(e);if(e instanceof Date)return s(e.getTime());if(a(e))return e;if(this._startTimeProvided)return s(Date.now());let r=i.now()-this._performanceStartTime;return l(this.startTime,s(r))}isRecording(){return!1===this._ended}recordException(e,t){let r={};"string"==typeof e?r[eS]=e:e&&(e.code?r[ey]=e.code.toString():e.name&&(r[ey]=e.name),e.message&&(r[eS]=e.message),e.stack&&(r["exception.stacktrace"]=e.stack)),r[ey]||r[eS]?this.addEvent("exception",r,t):ee.warn(`Failed to record an exception ${e}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){if(this._ended){let e=Error(`Operation attempted on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`);ee.warn(`Cannot execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`,e)}return this._ended}_truncateToLimitUtil(e,t){return e.length<=t?e:e.substring(0,t)}_truncateToSize(e){let t=this._attributeValueLengthLimit;return t<=0?(ee.warn(`Attribute value limit must be positive, got ${t}`),e):"string"==typeof e?this._truncateToLimitUtil(e,t):Array.isArray(e)?e.map(e=>"string"==typeof e?this._truncateToLimitUtil(e,t):e):e}};(D=P||(P={}))[D.NOT_RECORD=0]="NOT_RECORD",D[D.RECORD=1]="RECORD",D[D.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED";let AlwaysOffSampler=class AlwaysOffSampler{shouldSample(){return{decision:P.NOT_RECORD}}toString(){return"AlwaysOffSampler"}};let AlwaysOnSampler=class AlwaysOnSampler{shouldSample(){return{decision:P.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}};let ParentBasedSampler=class ParentBasedSampler{_root;_remoteParentSampled;_remoteParentNotSampled;_localParentSampled;_localParentNotSampled;constructor(e){this._root=e.root,this._root||(eA(Error("ParentBasedSampler must have a root sampler configured")),this._root=new AlwaysOnSampler),this._remoteParentSampled=e.remoteParentSampled??new AlwaysOnSampler,this._remoteParentNotSampled=e.remoteParentNotSampled??new AlwaysOffSampler,this._localParentSampled=e.localParentSampled??new AlwaysOnSampler,this._localParentNotSampled=e.localParentNotSampled??new AlwaysOffSampler}shouldSample(e,t,r,n,i,s){let o=tm.getSpanContext(e);return o&&to(o)?o.isRemote?o.traceFlags&w.SAMPLED?this._remoteParentSampled.shouldSample(e,t,r,n,i,s):this._remoteParentNotSampled.shouldSample(e,t,r,n,i,s):o.traceFlags&w.SAMPLED?this._localParentSampled.shouldSample(e,t,r,n,i,s):this._localParentNotSampled.shouldSample(e,t,r,n,i,s):this._root.shouldSample(e,t,r,n,i,s)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}};let TraceIdRatioBasedSampler=class TraceIdRatioBasedSampler{_ratio;_upperBound;constructor(e=0){this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(0xffffffff*this._ratio)}shouldSample(e,t){return{decision:ts(t)&&this._accumulate(t)<this._upperBound?P.RECORD_AND_SAMPLED:P.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e}_accumulate(e){let t=0;for(let r=0;r<e.length/8;r++){let n=8*r;t=(t^parseInt(e.slice(n,n+8),16))>>>0}return t}};function ty(){return{sampler:tE(),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:ec("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:ec("OTEL_ATTRIBUTE_COUNT_LIMIT")??128},spanLimits:{attributeValueLengthLimit:ec("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:ec("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??128,linkCountLimit:ec("OTEL_SPAN_LINK_COUNT_LIMIT")??128,eventCountLimit:ec("OTEL_SPAN_EVENT_COUNT_LIMIT")??128,attributePerEventCountLimit:ec("OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT")??128,attributePerLinkCountLimit:ec("OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT")??128}}}function tE(){let e=ep("OTEL_TRACES_SAMPLER")??A.ParentBasedAlwaysOn;switch(e){case A.AlwaysOn:return new AlwaysOnSampler;case A.AlwaysOff:return new AlwaysOffSampler;case A.ParentBasedAlwaysOn:return new ParentBasedSampler({root:new AlwaysOnSampler});case A.ParentBasedAlwaysOff:return new ParentBasedSampler({root:new AlwaysOffSampler});case A.TraceIdRatio:return new TraceIdRatioBasedSampler(tv());case A.ParentBasedTraceIdRatio:return new ParentBasedSampler({root:new TraceIdRatioBasedSampler(tv())});default:return ee.error(`OTEL_TRACES_SAMPLER value "${e}" invalid, defaulting to "${A.ParentBasedAlwaysOn}".`),new ParentBasedSampler({root:new AlwaysOnSampler})}}function tv(){let e=ec("OTEL_TRACES_SAMPLER_ARG");return null==e?(ee.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1):e<0||e>1?(ee.error(`OTEL_TRACES_SAMPLER_ARG=${e} was given, but it is out of range ([0..1]), defaulting to 1.`),1):e}(M=A||(A={})).AlwaysOff="always_off",M.AlwaysOn="always_on",M.ParentBasedAlwaysOff="parentbased_always_off",M.ParentBasedAlwaysOn="parentbased_always_on",M.ParentBasedTraceIdRatio="parentbased_traceidratio",M.TraceIdRatio="traceidratio";let tT=1/0;let RandomIdGenerator=class RandomIdGenerator{generateTraceId=tw(16);generateSpanId=tw(8)};let tb=Buffer.allocUnsafe(16);function tw(e){return function(){for(let t=0;t<e/4;t++)tb.writeUInt32BE(0x100000000*Math.random()>>>0,4*t);for(let t=0;t<e;t++)if(tb[t]>0)break;else t===e-1&&(tb[e-1]=1);return tb.toString("hex",0,e)}}let Tracer=class Tracer{_sampler;_generalLimits;_spanLimits;_idGenerator;instrumentationScope;_resource;_spanProcessor;constructor(e,t,r,n){let i,s,o;const a=(i={sampler:tE()},(o=Object.assign({},s=ty(),i,t)).generalLimits=Object.assign({},s.generalLimits,t.generalLimits||{}),o.spanLimits=Object.assign({},s.spanLimits,t.spanLimits||{}),o);this._sampler=a.sampler,this._generalLimits=a.generalLimits,this._spanLimits=a.spanLimits,this._idGenerator=t.idGenerator||new RandomIdGenerator,this._resource=r,this._spanProcessor=n,this.instrumentationScope=e}startSpan(e,t={},r=eF.active()){let n,i,s;t.root&&(r=tm.deleteSpan(r));let o=tm.getSpan(r);if(!0===r.getValue(ej))return ee.debug("Instrumentation suppressed, returning Noop Span"),tm.wrapSpanContext(e8);let a=o?.spanContext(),u=this._idGenerator.generateSpanId();a&&tm.isSpanContextValid(a)?(i=a.traceId,s=a.traceState,n=a):i=this._idGenerator.generateTraceId();let l=t.kind??v.INTERNAL,c=(t.links??[]).map(e=>({context:e.context,attributes:t_(e.attributes)})),p=t_(t.attributes),d=this._sampler.shouldSample(r,i,e,l,p,c);s=d.traceState??s;let h={traceId:i,spanId:u,traceFlags:d.decision===O.RECORD_AND_SAMPLED?w.SAMPLED:w.NONE,traceState:s};if(d.decision===O.NOT_RECORD)return ee.debug("Recording is off, propagating context in a non-recording span"),tm.wrapSpanContext(h);let f=t_(Object.assign(p,d.attributes));return new SpanImpl({resource:this._resource,scope:this.instrumentationScope,context:r,spanContext:h,name:e,kind:l,links:c,parentSpanContext:n,attributes:f,startTime:t.startTime,spanProcessor:this._spanProcessor,spanLimits:this._spanLimits})}startActiveSpan(e,t,r,n){let i,s,o;if(arguments.length<2)return;2==arguments.length?o=t:3==arguments.length?(i=t,o=r):(i=t,s=r,o=n);let a=s??eF.active(),u=this.startSpan(e,i,a),l=tm.setSpan(a,u);return eF.with(l,o,void 0,u)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}};let MultiSpanProcessor=class MultiSpanProcessor{_spanProcessors;constructor(e){this._spanProcessors=e}forceFlush(){let e=[];for(let t of this._spanProcessors)e.push(t.forceFlush());return new Promise(t=>{Promise.all(e).then(()=>{t()}).catch(e=>{eA(e||Error("MultiSpanProcessor: forceFlush failed")),t()})})}onStart(e,t){for(let r of this._spanProcessors)r.onStart(e,t)}onEnd(e){for(let t of this._spanProcessors)t.onEnd(e)}shutdown(){let e=[];for(let t of this._spanProcessors)e.push(t.shutdown());return new Promise((t,r)=>{Promise.all(e).then(()=>{t()},r)})}};(B=x||(x={}))[B.resolved=0]="resolved",B[B.timeout=1]="timeout",B[B.error=2]="error",B[B.unresolved=3]="unresolved";let BasicTracerProvider=class BasicTracerProvider{_config;_tracers=new Map;_resource;_activeSpanProcessor;constructor(e={}){let t;const r=function(...e){let t=e.shift(),r=new WeakMap;for(;e.length>0;)t=function e(t,r,n=0,i){let s;if(!(n>20)){if(n++,e1(t)||e1(r)||eZ(r))s=eW(r);else if(eq(t)){if(s=t.slice(),eq(r))for(let e=0,t=r.length;e<t;e++)s.push(eW(r[e]));else if(e0(r)){let e=Object.keys(r);for(let t=0,n=e.length;t<n;t++){let n=e[t];s[n]=eW(r[n])}}}else if(e0(t))if(e0(r)){var o,a;if(o=t,a=r,!(eJ(o)&&eJ(a)))return r;s=Object.assign({},t);let u=Object.keys(r);for(let o=0,a=u.length;o<a;o++){let a=u[o],l=r[a];if(e1(l))void 0===l?delete s[a]:s[a]=l;else{let o=s[a];if(eY(t,a,i)||eY(r,a,i))delete s[a];else{if(e0(o)&&e0(l)){let e=i.get(o)||[],n=i.get(l)||[];e.push({obj:t,key:a}),n.push({obj:r,key:a}),i.set(o,e),i.set(l,n)}s[a]=e(s[a],l,n,i)}}}}else s=r;return s}}(t,e.shift(),0,r);return t}({},ty(),((t=Object.assign({},e.spanLimits)).attributeCountLimit=e.spanLimits?.attributeCountLimit??e.generalLimits?.attributeCountLimit??ec("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??ec("OTEL_ATTRIBUTE_COUNT_LIMIT")??128,t.attributeValueLengthLimit=e.spanLimits?.attributeValueLengthLimit??e.generalLimits?.attributeValueLengthLimit??ec("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??ec("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??tT,Object.assign({},e,{spanLimits:t})));this._resource=r.resource??eL({[eE]:`unknown_service:${process.argv0}`,[ev]:ew[ev],[eT]:ew[eT],[eb]:ew[eb]}),this._config=Object.assign({},r,{resource:this._resource});const n=[];e.spanProcessors?.length&&n.push(...e.spanProcessors),this._activeSpanProcessor=new MultiSpanProcessor(n)}getTracer(e,t,r){let n=`${e}@${t||""}:${r?.schemaUrl||""}`;return this._tracers.has(n)||this._tracers.set(n,new Tracer({name:e,version:t,schemaUrl:r?.schemaUrl},this._config,this._resource,this._activeSpanProcessor)),this._tracers.get(n)}forceFlush(){let e=this._config.forceFlushTimeoutMillis,t=this._activeSpanProcessor._spanProcessors.map(t=>new Promise(r=>{let n,i=setTimeout(()=>{r(Error(`Span processor did not completed within timeout period of ${e} ms`)),n=x.timeout},e);t.forceFlush().then(()=>{clearTimeout(i),n!==x.timeout&&r(n=x.resolved)}).catch(e=>{clearTimeout(i),n=x.error,r(e)})}));return new Promise((e,r)=>{Promise.all(t).then(t=>{let n=t.filter(e=>e!==x.resolved);n.length>0?r(n):e()}).catch(e=>r([e]))})}shutdown(){return this._activeSpanProcessor.shutdown()}};var tO=((k=tO||{}).NONE="none",k.GZIP="gzip",k);let OpenTelemetryProvider=class OpenTelemetryProvider{_globalAttributes={};provider;tracer;constructor(e,t,r){const n=new OTLPTraceExporter({url:r?"https://otel-dev.gitkraken.com/v1/traces":"https://otel.gitkraken.com/v1/traces",compression:"gzip",httpAgentOptions:t?.options}),i=[];r?i.push(new SimpleSpanProcessor(n)):i.push(new BatchSpanProcessor(n)),this.provider=new BasicTracerProvider({resource:eL({[eE]:"gitlens","service.version":e.extensionVersion,"deployment.environment":e.env,"deployment.environment.name":e.env,"device.id":e.machineId,"os.type":e.platform,"extension.id":e.extensionId,"session.id":e.sessionId,language:e.language,"vscode.edition":e.vscodeEdition,"vscode.version":e.vscodeVersion,"vscode.host":e.vscodeHost,"vscode.remoteName":e.vscodeRemoteName,"vscode.shell":e.vscodeShell,"vscode.uiKind":e.vscodeUIKind}),spanProcessors:i}),this.tracer=this.provider.getTracer(e.extensionId)}dispose(){this.provider.shutdown()}sendEvent(e,t,r,n){let i=this.tracer.startSpan(e,{attributes:this._globalAttributes,kind:v.INTERNAL,startTime:r??Date.now()});null!=t&&i.setAttributes(t),i.end(n)}startEvent(e,t,r){let n=this.tracer.startSpan(e,{attributes:this._globalAttributes,kind:v.INTERNAL,startTime:r??Date.now()});return null!=t&&n.setAttributes(t),n}setGlobalAttributes(e){this._globalAttributes=Object.fromEntries(e)}}}};