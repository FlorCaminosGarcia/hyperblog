exports.id=795,exports.ids=[795],exports.modules={2445:(e,t,i)=>{i.d(t,{GraphWebviewProvider:()=>GraphWebviewProvider});var r=i(1398),s=i(2625),a=i(5065),o=i(746),n=i(8412),h=i(7916),l=i(5859),p=i(4230),c=i(7551),g=i(1709),d=i(6123),u=i(6234),m=i(4201),v=i(316),f=i(8847),w=i(9389),y=i(819),b=i(1522),C=i(302),R=i(689),P=i(6695),W=i(3182),S=i(7442),k=i(4169),_=i(9487),D=i(1558),G=i(3287),T=i(9395),I=i(5619),M=i(2331),H=i(7186),O=i(777),B=i(3177),x=i(1576),V=i(3790),q=i(4039),A=i(7614),F=i(6652),L=i(41),E=i(4641),z=i(6402),$=i(9827),N=i(2792),U=i(2948),j=i(2809),Y=i(6434),Q=i(4981),Z=i(1335),J=i(3991),K=i(3874),X=i(7820),ee=i(3582),et=i(5754),ei=i(8261),er=i(7555),es=i(9061),ea=i(4109),eo=i(5658);async function en(e){return e.length?(await Promise.allSettled(e.map(async e=>{let t=await e.git.remotes.getBestRemotesWithProviders(),i=t.find(e=>e.supportsIntegration())??t[0];return(0,eo.GS)(e,i)}))).map(e=>(0,X.Ro)(e)).filter(e=>null!=e):[]}function eh(e){return null!=e&&(0,et.sc)(e)&&("gitlens.graph"===e.webview||"gitlens.views.graph"===e.webview)}function el(e,t){return null!=e&&eh(e)&&"object"==typeof e.webviewItemValue&&e.webviewItemValue.type===t}function ep(e,t){return null!=e&&eh(e)&&"object"==typeof e.webviewItemValue&&"ref"in e.webviewItemValue&&(null==t||e.webviewItemValue.ref.refType===t)}function ec(e){return null!=e&&"object"==typeof e&&"ref"in e&&(0,x.cf)(e.ref)}var eg=i(994);let ed="graph",eu=["upstream","pullRequest","issue"],em=new eg.Q2(ed,"chooseRepository"),ev=new eg.Q2(ed,"dblclick");new eg.Q2(ed,"dblclick");let ef=new eg.Q2(ed,"avatars/get"),ew=new eg.Q2(ed,"refs/metadata/get"),ey=new eg.Q2(ed,"rows/get"),eb=new eg.Q2(ed,"pullRequest/openDetails"),eC=new eg.Q2(ed,"search/openInView"),eR=new eg.Q2(ed,"columns/update"),eP=new eg.Q2(ed,"refs/update/visibility"),eW=new eg.Q2(ed,"filters/update/excludeTypes"),eS=new eg.Q2(ed,"configuration/update"),ek=new eg.Q2(ed,"search/update/mode"),e_=new eg.Q2(ed,"filters/update/includedRefs"),eD=new eg.Q2(ed,"selection/update"),eG=new eg.Oz(ed,"jumpToHead"),eT=new eg.Oz(ed,"chooseRef"),eI=new eg.Oz(ed,"rows/ensure"),eM=new eg.Oz(ed,"search/history/get"),eH=new eg.Oz(ed,"search/history/store"),eO=new eg.Oz(ed,"search/history/delete"),eB=new eg.Oz(ed,"counts"),ex=new eg.Oz(ed,"row/hover/get"),eV=new eg.Oz(ed,"search"),eq=new eg.C1(ed,"repositories/integration/didChange"),eA=new eg.C1(ed,"didChange",!0),eF=new eg.C1(ed,"configuration/didChange"),eL=new eg.C1(ed,"subscription/didChange"),eE=new eg.C1(ed,"org/settings/didChange"),ez=new eg.C1(ed,"avatars/didChange"),e$=new eg.C1(ed,"mcp/didChange"),eN=new eg.C1(ed,"branchState/didChange"),eU=new eg.C1(ed,"refs/didChangeMetadata"),ej=new eg.C1(ed,"columns/didChange"),eY=new eg.C1(ed,"scrollMarkers/didChange"),eQ=new eg.C1(ed,"refs/didChangeVisibility"),eZ=new eg.C1(ed,"rows/didChange"),eJ=new eg.C1(ed,"rows/stats/didChange"),eK=new eg.C1(ed,"selection/didChange"),eX=new eg.C1(ed,"workingTree/didChange"),e0=new eg.C1(ed,"didSearch"),e1=new eg.C1(ed,"didFetch"),e2=new eg.C1(ed,"featurePreview/didStart");let SearchHistory=class SearchHistory{constructor(e,t){this.storage=e,this.repoPath=t}async delete(e){if(!e?.trim()||!this.repoPath)return;let t=`graph:searchHistory:${this.repoPath}`,i=this.storage.getWorkspace(t)??[],r=i.filter(t=>t.query!==e);r.length<i.length&&await this.storage.storeWorkspace(t,r)}get(){if(!this.repoPath)return[];let e=`graph:searchHistory:${this.repoPath}`;return(this.storage.getWorkspace(e)??[]).map(e=>({query:e.query,matchAll:e.matchAll,matchCase:e.matchCase,matchRegex:e.matchRegex,matchWholeWord:e.matchWholeWord,naturalLanguage:e.naturalLanguage?{query:e.query,processedQuery:e.nlStructuredQuery}:void 0}))}async store(e){if(!e.query?.trim()||!this.repoPath)return;let t=`graph:searchHistory:${this.repoPath}`,i=this.storage.getWorkspace(t)??[],r=e.naturalLanguage?e.query:e5(e.query),s=e5(r),a=i.findIndex(e=>e5((e.naturalLanguage,e.query))===s);a>=0&&i.splice(a,1);let o=[{query:e.query,matchAll:e.matchAll,matchCase:e.matchCase,matchRegex:e.matchRegex,matchWholeWord:e.matchWholeWord,naturalLanguage:!!e.naturalLanguage||void 0,nlStructuredQuery:e.naturalLanguage&&"boolean"!=typeof e.naturalLanguage?e.naturalLanguage.processedQuery:void 0},...i];await this.storage.storeWorkspace(t,o.slice(0,50))}};function e5(e,t=!1){let i=e.trim().replace(/\s+/g," ");return/\bauthor:\s*@?me\b/i.test(i)&&(i=i.replace(/(^|\s)@me(\s|$)/gi," ").replace(/\s+/g," ").trim()),i.toLowerCase()}var e9=Object.defineProperty,e4=Object.getOwnPropertyDescriptor,e3=e=>{throw TypeError(e)},e6=(e,t,i,r)=>{for(var s,a=r>1?void 0:r?e4(t,i):t,o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r?s(t,i,a):s(a))||a);return r&&a&&e9(t,i,a),a};let e8={ref:{width:130,isHidden:!1,order:0},graph:{width:150,mode:void 0,isHidden:!1,order:1},message:{width:300,isHidden:!1,order:2},author:{width:130,isHidden:!1,order:3},changes:{width:200,isHidden:!1,order:4},datetime:{width:130,isHidden:!1,order:5},sha:{width:130,isHidden:!1,order:6}},e7={ref:{width:32,isHidden:!1},graph:{width:150,mode:"compact",isHidden:!1},author:{width:32,isHidden:!1,order:2},message:{width:500,isHidden:!1,order:3},changes:{width:200,isHidden:!1,order:4},datetime:{width:130,isHidden:!0,order:5},sha:{width:130,isHidden:!1,order:6}};let GraphWebviewProvider=class GraphWebviewProvider{constructor(e,t){this.container=e,this.host=t,this._showDetailsView=z.H.get("graph.showDetailsView"),this._theme=r.window.activeColorTheme,this.ensureRepositorySubscriptions(),this._disposable=r.Disposable.from(z.H.onDidChange(this.onConfigurationChanged,this),this.container.subscription.onDidChange(this.onSubscriptionChanged,this),this.container.storage.onDidChange(this.onStorageChanged,this),(0,$.wt)(this.onContextChanged,this),this.container.subscription.onDidChangeFeaturePreview(this.onFeaturePreviewChanged,this),this.container.git.onDidChangeRepositories(async()=>{this._etag!==this.container.git.etag&&(null==this._discovering||(this._etag=await this._discovering,this._etag!==this.container.git.etag))&&this.updateState()}),r.window.onDidChangeActiveColorTheme(this.onThemeChanged,this),{dispose:()=>{null!=this._repositoryEventsDisposable&&(this._repositoryEventsDisposable.dispose(),this._repositoryEventsDisposable=void 0)}},this.container.integrations.onDidChangeConnectionState(this.onIntegrationConnectionChanged,this))}_repository;get repository(){return this._repository}set repository(e){this._repository===e?this.ensureRepositorySubscriptions():(this._repository=e,this.resetRepositoryState(),this.ensureRepositorySubscriptions(!0),this.host.ready&&this.updateState())}_selection;get activeSelection(){return this._selection?.[0]}_cancellations=new Map;_discovering;_disposable;_etag;_etagSubscription;_etagRepository;_firstSelection=!0;_getBranchesAndTagsTips;_graph;_hoverCache=new Map;_ipcNotificationMap=new Map([[ej,this.notifyDidChangeColumns],[eF,this.notifyDidChangeConfiguration],[eA,this.notifyDidChangeState],[eQ,this.notifyDidChangeRefsVisibility],[eY,this.notifyDidChangeScrollMarkers],[eK,this.notifyDidChangeSelection],[eL,this.notifyDidChangeSubscription],[eX,this.notifyDidChangeWorkingTree],[e1,this.notifyDidFetch],[e2,this.notifyDidStartFeaturePreview]]);_refsMetadata;_search;_selectedId;_selectedRows;_showDetailsView;_theme;_repositoryEventsDisposable;_lastFetchedDisposable;_searchHistory;isWindowFocused=!0;dispose(){this._disposable.dispose()}canReuseInstance(...e){let t;if(1===this.container.git.openRepositoryCount)return!0;let[i]=e;return(0,P.Z6)(i)?t=i:ec(i)?t=this.container.git.getRepository(i.ref.repoPath):(0,es.c)(i)&&null!=i.state.selectedRepository&&(t=this.container.git.getRepository(i.state.selectedRepository)),t?.uri.toString()===this.repository?.uri.toString()||void 0}getSplitArgs(){return null!=this.repository?[this.repository]:[]}getTelemetryContext(){return{...this.host.getTelemetryContext(),"context.repository.id":this.repository?.idHash,"context.repository.scheme":this.repository?.uri.scheme,"context.repository.closed":this.repository?.closed,"context.repository.folder.scheme":this.repository?.folder?.uri.scheme,"context.repository.provider.id":this.repository?.provider.id}}getShownTelemetryContext(){let e={},t=this.getColumns();if(null!=t)for(let[i,r]of Object.entries(t))r.isHidden||(e[`context.column.${i}.visible`]=!0),null!=r.mode&&(e[`context.column.${i}.mode`]=r.mode);let i=(0,K.Bq)(z.H.get("graph"),"context.config",{joinArrays:!0});return{...this.getTelemetryContext(),...e,...i}}_searchRequest;async onShowing(e,t,...i){this._firstSelection=!0,this._etag=this.container.git.etag,this.container.git.isDiscoveringRepositories&&(this._discovering=this.container.git.isDiscoveringRepositories.then(e=>(this._discovering=void 0,e)),this._etag=await this._discovering);let[r]=i;if((0,P.Z6)(r))this.repository=r;else if(ec(r)){this.repository=this.container.git.getRepository(r.ref.repoPath);let e=r.ref.ref;if((0,V.HH)(e)||(e=(await this.container.git.getRepositoryService(r.ref.repoPath).revision.resolveRevision(e)).sha),this.setSelectedRows(e),null!=this._graph){if(this._graph?.ids.has(e))return this.notifyDidChangeSelection(),[!0,this.getShownTelemetryContext()];this.onGetMoreRows({id:e},!0)}}else if(r?.repository!=null&&r?.search!=null)this.repository=r.repository,this._searchRequest=r.search,this.updateState();else if((0,es.c)(r)&&null!=r.state.selectedRepository&&(this.repository=this.container.git.getRepository(r.state.selectedRepository)),null==this.repository&&this.container.git.repositoryCount>1){let[t]=(0,a.qU)("gitlens.showGraph",void 0,...i);"scm"===t.type&&null!=t.scm.rootUri?this.repository=this.container.git.getRepository(t.scm.rootUri):"viewItem"===t.type&&t.node instanceof er.P&&(this.repository=t.node.repo),null!=this.repository&&!e&&this.host.ready&&this.updateState()}return[!0,this.getShownTelemetryContext()]}onRefresh(e){e&&this.resetRepositoryState()}includeBootstrap(e){return this.getState(!0)}registerCommands(){let e=[];return this.host.is("view")&&e.push((0,E.Lb)(`${this.host.id}.refresh`,()=>this.host.refresh(!0)),(0,E.Lb)(`${this.host.id}.openInTab`,()=>void(0,E.RS)("gitlens.showGraphPage",void 0,this.repository))),e.push(this.host.registerWebviewCommand("gitlens.graph.push",this.push),this.host.registerWebviewCommand("gitlens.graph.pull",this.pull),this.host.registerWebviewCommand("gitlens.graph.fetch",this.fetch),this.host.registerWebviewCommand("gitlens.graph.pushWithForce",this.forcePush),this.host.registerWebviewCommand("gitlens.graph.publishBranch",this.publishBranch),this.host.registerWebviewCommand("gitlens.graph.switchToAnotherBranch",this.switchToAnother),this.host.registerWebviewCommand("gitlens.graph.createBranch",this.createBranch),this.host.registerWebviewCommand("gitlens.graph.deleteBranch",this.deleteBranch),this.host.registerWebviewCommand("gitlens.star.branch:graph",this.star),this.host.registerWebviewCommand("gitlens.unstar.branch:graph",this.unstar),this.host.registerWebviewCommand("gitlens.graph.copyRemoteBranchUrl",e=>this.openBranchOnRemote(e,!0)),this.host.registerWebviewCommand("gitlens.graph.openBranchOnRemote",this.openBranchOnRemote),this.host.registerWebviewCommand("gitlens.graph.mergeBranchInto",this.mergeBranchInto),this.host.registerWebviewCommand("gitlens.graph.rebaseOntoBranch",this.rebase),this.host.registerWebviewCommand("gitlens.graph.rebaseOntoUpstream",this.rebaseToRemote),this.host.registerWebviewCommand("gitlens.graph.renameBranch",this.renameBranch),this.host.registerWebviewCommand("gitlens.graph.associateIssueWithBranch",this.associateIssueWithBranch),this.host.registerWebviewCommand("gitlens.changeUpstream:graph",this.changeUpstreamBranch),this.host.registerWebviewCommand("gitlens.setUpstream:graph",this.changeUpstreamBranch),this.host.registerWebviewCommand("gitlens.graph.switchToBranch",this.switchTo),this.host.registerWebviewCommand("gitlens.graph.hideLocalBranch",this.hideRef),this.host.registerWebviewCommand("gitlens.graph.hideRemoteBranch",this.hideRef),this.host.registerWebviewCommand("gitlens.graph.hideRemote",e=>this.hideRef(e,{remote:!0})),this.host.registerWebviewCommand("gitlens.graph.hideRefGroup",e=>this.hideRef(e,{group:!0})),this.host.registerWebviewCommand("gitlens.graph.hideTag",this.hideRef),this.host.registerWebviewCommand("gitlens.graph.soloBranch",this.soloReference),this.host.registerWebviewCommand("gitlens.graph.soloTag",this.soloReference),this.host.registerWebviewCommand("gitlens.graph.cherryPick",this.cherryPick),this.host.registerWebviewCommand("gitlens.graph.cherryPick.multi",this.cherryPick),this.host.registerWebviewCommand("gitlens.graph.copyRemoteCommitUrl",e=>this.openCommitOnRemote(e,!0)),this.host.registerWebviewCommand("gitlens.graph.copyRemoteCommitUrl.multi",e=>this.openCommitOnRemote(e,!0)),this.host.registerWebviewCommand("gitlens.graph.openCommitOnRemote",this.openCommitOnRemote),this.host.registerWebviewCommand("gitlens.graph.openCommitOnRemote.multi",this.openCommitOnRemote),this.host.registerWebviewCommand("gitlens.graph.commitViaSCM",this.commitViaSCM),this.host.registerWebviewCommand("gitlens.graph.rebaseOntoCommit",this.rebase),this.host.registerWebviewCommand("gitlens.graph.resetCommit",this.resetCommit),this.host.registerWebviewCommand("gitlens.graph.resetToCommit",this.resetToCommit),this.host.registerWebviewCommand("gitlens.graph.resetToTip",this.resetToTip),this.host.registerWebviewCommand("gitlens.graph.revert",this.revertCommit),this.host.registerWebviewCommand("gitlens.graph.showInDetailsView",this.openInDetailsView),this.host.registerWebviewCommand("gitlens.graph.switchToCommit",this.switchTo),this.host.registerWebviewCommand("gitlens.graph.undoCommit",this.undoCommit),this.host.registerWebviewCommand("gitlens.stashSave:graph",this.saveStash),this.host.registerWebviewCommand("gitlens.stashApply:graph",this.applyStash),this.host.registerWebviewCommand("gitlens.stashDelete:graph",this.deleteStash),this.host.registerWebviewCommand("gitlens.stashRename:graph",this.renameStash),this.host.registerWebviewCommand("gitlens.graph.createTag",this.createTag),this.host.registerWebviewCommand("gitlens.graph.deleteTag",this.deleteTag),this.host.registerWebviewCommand("gitlens.graph.switchToTag",this.switchTo),this.host.registerWebviewCommand("gitlens.graph.resetToTag",this.resetToTag),this.host.registerWebviewCommand("gitlens.graph.createWorktree",this.createWorktree),this.host.registerWebviewCommand("gitlens.graph.createPullRequest",this.createPullRequest),this.host.registerWebviewCommand("gitlens.graph.openPullRequest",this.openPullRequest),this.host.registerWebviewCommand("gitlens.graph.openPullRequestChanges",this.openPullRequestChanges),this.host.registerWebviewCommand("gitlens.graph.openPullRequestComparison",this.openPullRequestComparison),this.host.registerWebviewCommand("gitlens.graph.openPullRequestOnRemote",this.openPullRequestOnRemote),this.host.registerWebviewCommand("gitlens.graph.openChangedFileDiffsWithMergeBase",this.openChangedFileDiffsWithMergeBase),this.host.registerWebviewCommand("gitlens.graph.compareWithUpstream",this.compareWithUpstream),this.host.registerWebviewCommand("gitlens.graph.compareWithHead",this.compareHeadWith),this.host.registerWebviewCommand("gitlens.graph.compareBranchWithHead",this.compareBranchWithHead),this.host.registerWebviewCommand("gitlens.graph.compareWithWorking",this.compareWorkingWith),this.host.registerWebviewCommand("gitlens.graph.compareWithMergeBase",this.compareWithMergeBase),this.host.registerWebviewCommand("gitlens.graph.compareAncestryWithWorking",this.compareAncestryWithWorking),this.host.registerWebviewCommand("gitlens.graph.copy",this.copy),this.host.registerWebviewCommand("gitlens.graph.copyMessage",this.copyMessage),this.host.registerWebviewCommand("gitlens.graph.copySha",this.copySha),this.host.registerWebviewCommand("gitlens.graph.addAuthor",this.addAuthor),this.host.registerWebviewCommand("gitlens.graph.columnAuthorOn",()=>this.toggleColumn("author",!0)),this.host.registerWebviewCommand("gitlens.graph.columnAuthorOff",()=>this.toggleColumn("author",!1)),this.host.registerWebviewCommand("gitlens.graph.columnDateTimeOn",()=>this.toggleColumn("datetime",!0)),this.host.registerWebviewCommand("gitlens.graph.columnDateTimeOff",()=>this.toggleColumn("datetime",!1)),this.host.registerWebviewCommand("gitlens.graph.columnShaOn",()=>this.toggleColumn("sha",!0)),this.host.registerWebviewCommand("gitlens.graph.columnShaOff",()=>this.toggleColumn("sha",!1)),this.host.registerWebviewCommand("gitlens.graph.columnChangesOn",()=>this.toggleColumn("changes",!0)),this.host.registerWebviewCommand("gitlens.graph.columnChangesOff",()=>this.toggleColumn("changes",!1)),this.host.registerWebviewCommand("gitlens.graph.columnGraphOn",()=>this.toggleColumn("graph",!0)),this.host.registerWebviewCommand("gitlens.graph.columnGraphOff",()=>this.toggleColumn("graph",!1)),this.host.registerWebviewCommand("gitlens.graph.columnMessageOn",()=>this.toggleColumn("message",!0)),this.host.registerWebviewCommand("gitlens.graph.columnMessageOff",()=>this.toggleColumn("message",!1)),this.host.registerWebviewCommand("gitlens.graph.columnRefOn",()=>this.toggleColumn("ref",!0)),this.host.registerWebviewCommand("gitlens.graph.columnRefOff",()=>this.toggleColumn("ref",!1)),this.host.registerWebviewCommand("gitlens.graph.columnGraphCompact",()=>this.setColumnMode("graph","compact")),this.host.registerWebviewCommand("gitlens.graph.columnGraphDefault",()=>this.setColumnMode("graph",void 0)),this.host.registerWebviewCommand("gitlens.graph.scrollMarkerLocalBranchOn",()=>this.toggleScrollMarker("localBranches",!0)),this.host.registerWebviewCommand("gitlens.graph.scrollMarkerLocalBranchOff",()=>this.toggleScrollMarker("localBranches",!1)),this.host.registerWebviewCommand("gitlens.graph.scrollMarkerRemoteBranchOn",()=>this.toggleScrollMarker("remoteBranches",!0)),this.host.registerWebviewCommand("gitlens.graph.scrollMarkerRemoteBranchOff",()=>this.toggleScrollMarker("remoteBranches",!1)),this.host.registerWebviewCommand("gitlens.graph.scrollMarkerStashOn",()=>this.toggleScrollMarker("stashes",!0)),this.host.registerWebviewCommand("gitlens.graph.scrollMarkerStashOff",()=>this.toggleScrollMarker("stashes",!1)),this.host.registerWebviewCommand("gitlens.graph.scrollMarkerTagOn",()=>this.toggleScrollMarker("tags",!0)),this.host.registerWebviewCommand("gitlens.graph.scrollMarkerTagOff",()=>this.toggleScrollMarker("tags",!1)),this.host.registerWebviewCommand("gitlens.graph.scrollMarkerPullRequestOn",()=>this.toggleScrollMarker("pullRequests",!0)),this.host.registerWebviewCommand("gitlens.graph.scrollMarkerPullRequestOff",()=>this.toggleScrollMarker("pullRequests",!1)),this.host.registerWebviewCommand("gitlens.graph.copyDeepLinkToBranch",this.copyDeepLinkToBranch),this.host.registerWebviewCommand("gitlens.graph.copyDeepLinkToCommit",this.copyDeepLinkToCommit),this.host.registerWebviewCommand("gitlens.graph.copyDeepLinkToRepo",this.copyDeepLinkToRepo),this.host.registerWebviewCommand("gitlens.graph.copyDeepLinkToTag",this.copyDeepLinkToTag),this.host.registerWebviewCommand("gitlens.graph.shareAsCloudPatch",this.shareAsCloudPatch),this.host.registerWebviewCommand("gitlens.graph.createPatch",this.shareAsCloudPatch),this.host.registerWebviewCommand("gitlens.graph.createCloudPatch",this.shareAsCloudPatch),this.host.registerWebviewCommand("gitlens.copyPatchToClipboard:graph",this.copyPatchToClipboard),this.host.registerWebviewCommand("gitlens.graph.openChangedFiles",this.openFiles),this.host.registerWebviewCommand("gitlens.graph.openOnlyChangedFiles",this.openOnlyChangedFiles),this.host.registerWebviewCommand("gitlens.graph.openChangedFileDiffs",e=>this.openAllChanges(e)),this.host.registerWebviewCommand("gitlens.graph.openChangedFileDiffsWithWorking",e=>this.openAllChangesWithWorking(e)),this.host.registerWebviewCommand("gitlens.graph.openChangedFileDiffsIndividually",e=>this.openAllChanges(e,!0)),this.host.registerWebviewCommand("gitlens.graph.openChangedFileDiffsWithWorkingIndividually",e=>this.openAllChangesWithWorking(e,!0)),this.host.registerWebviewCommand("gitlens.graph.openChangedFileRevisions",this.openRevisions),this.host.registerWebviewCommand("gitlens.graph.resetColumnsDefault",()=>this.updateColumns(e8)),this.host.registerWebviewCommand("gitlens.graph.resetColumnsCompact",()=>this.updateColumns(e7)),this.host.registerWebviewCommand("gitlens.graph.openInWorktree",this.openInWorktree),this.host.registerWebviewCommand("gitlens.graph.openWorktree",this.openWorktree),this.host.registerWebviewCommand("gitlens.graph.openWorktreeInNewWindow",e=>this.openWorktree(e,{location:"newWindow"})),this.host.registerWebviewCommand("gitlens.graph.copyWorkingChangesToWorktree",this.copyWorkingChangesToWorktree),this.host.registerWebviewCommand("gitlens.ai.generateCommitMessage:graph",this.generateCommitMessage),this.host.registerWebviewCommand("gitlens.ai.explainUnpushed:graph",this.aiExplainUnpushed),this.host.registerWebviewCommand("gitlens.ai.explainBranch:graph",this.explainBranch),this.host.registerWebviewCommand("gitlens.ai.explainCommit:graph",this.explainCommit),this.host.registerWebviewCommand("gitlens.recomposeBranch:graph",this.recomposeBranch),this.host.registerWebviewCommand("gitlens.ai.explainStash:graph",this.explainStash),this.host.registerWebviewCommand("gitlens.ai.explainWip:graph",this.explainWip),this.host.registerWebviewCommand("gitlens.graph.compareSelectedCommits.multi",this.compareSelectedCommits),this.host.registerWebviewCommand("gitlens.graph.abortPausedOperation",this.abortPausedOperation),this.host.registerWebviewCommand("gitlens.graph.continuePausedOperation",this.continuePausedOperation),this.host.registerWebviewCommand("gitlens.graph.openRebaseEditor",this.openRebaseEditor),this.host.registerWebviewCommand("gitlens.graph.skipPausedOperation",this.skipPausedOperation),this.host.registerWebviewCommand("gitlens.ai.generateChangelogFrom:graph",this.generateChangelogFrom),this.host.registerWebviewCommand("gitlens.composeCommits:graph",e=>this.composeCommits(e)),this.host.registerWebviewCommand("gitlens.ai.rebaseOntoCommit:graph",this.rebaseOntoCommit),this.host.registerWebviewCommand("gitlens.visualizeHistory.repo:graph",this.visualizeHistoryRepo)),e}onWindowFocusChanged(e){this.isWindowFocused=e}onFocusChanged(e){this._showActiveSelectionDetailsDebounced?.cancel(),e&&null!=this.activeSelection&&(this.container.views.commitDetails.visible||this.container.views.graphDetails.visible)&&this.showActiveSelectionDetails()}onVisibilityChanged(e){if(e||this._showActiveSelectionDetailsDebounced?.cancel(),e&&(null!=this.repository&&this.repository.etag!==this._etagRepository||this.container.subscription.etag!==this._etagSubscription))return void this.updateState(!0);if(e){this.host.sendPendingIpcNotifications();let{activeSelection:e}=this;if(null==e)return;this.showActiveSelectionDetails()}}onMessageReceived(e){switch(!0){case em.is(e):this.onChooseRepository();break;case eT.is(e):this.onChooseRef(eT,e);break;case eG.is(e):this.onJumpToHead(eG,e);break;case ev.is(e):this.onDoubleClick(e.params);break;case eI.is(e):this.onEnsureRowRequest(eI,e);break;case eB.is(e):this.onGetCounts(eB,e);break;case ef.is(e):this.onGetMissingAvatars(e.params);break;case ew.is(e):this.onGetMissingRefMetadata(e.params);break;case ey.is(e):this.onGetMoreRows(e.params);break;case ex.is(e):this.onHoverRowRequest(ex,e);break;case eb.is(e):this.onOpenPullRequestDetails(e.params);break;case eV.is(e):this.onSearchRequest(eV,e);break;case eC.is(e):this.onSearchOpenInView(e.params);break;case eM.is(e):this.onSearchHistoryGetRequest(eM,e);break;case eH.is(e):this.onSearchHistoryStoreRequest(eH,e);break;case eO.is(e):this.onSearchHistoryDeleteRequest(eO,e);break;case eR.is(e):this.onColumnsChanged(e.params);break;case eS.is(e):this.updateGraphConfig(e.params);break;case ek.is(e):this.updateGraphSearchMode(e.params);break;case eW.is(e):this.updateExcludedTypes(this._graph?.repoPath,e.params);break;case e_.is(e):this.updateIncludeOnlyRefs(this._graph?.repoPath,e.params);break;case eP.is(e):this.onRefsVisibilityChanged(e.params);break;case eD.is(e):this.onSelectionChanged(e.params)}}async onGetCounts(e,t){let i;if(null!=this._graph){let e=await this.container.git.getRepositoryService(this._graph.repoPath).tags.getTags();i={branches:(0,J.U9)(this._graph.branches?.values(),e=>!e.remote),remotes:this._graph.remotes.size,stashes:this._graph.stashes?.size,worktrees:null!=this._graph.worktrees?this._graph.worktrees.length-1:void 0,tags:e.values.length}}else i=void 0;this.host.respond(e,t,i)}updateGraphConfig(e){let t,i=this.getComponentConfig();for(t in e.changes)if(i[t]!==e.changes[t])switch(t){case"minimap":z.H.updateEffective("graph.minimap.enabled",e.changes[t]);break;case"minimapDataType":z.H.updateEffective("graph.minimap.dataType",e.changes[t]);break;case"minimapMarkerTypes":{let i=[];for(let r of e.changes[t]??[])switch(r){case"localBranches":case"remoteBranches":case"stashes":case"tags":case"pullRequests":i.push(r)}z.H.updateEffective("graph.minimap.additionalTypes",i);break}case"dimMergeCommits":z.H.updateEffective("graph.dimMergeCommits",e.changes[t]);break;case"onlyFollowFirstParent":z.H.updateEffective("graph.onlyFollowFirstParent",e.changes[t])}}updateGraphSearchMode(e){this.container.storage.store("graph:searchMode",e.searchMode).catch(),this.container.storage.store("graph:useNaturalLanguageSearch",e.useNaturalLanguage).catch(),this._search?.query!=null&&(this._search={...this._search,query:{...this._search.query,filter:"filter"===e.searchMode}})}_showActiveSelectionDetailsDebounced=void 0;showActiveSelectionDetails(){this._showActiveSelectionDetailsDebounced??=(0,Z.s)(this.showActiveSelectionDetailsCore.bind(this),250),this._showActiveSelectionDetailsDebounced()}showActiveSelectionDetailsCore(){let{activeSelection:e}=this;null!=e&&this.host.active&&this.container.events.fire("commit:selected",{commit:e,interaction:"passive",preserveFocus:!0,preserveVisibility:!1===this._showDetailsView,searchContext:this.getSearchContext(e.ref)},{source:this.host.id})}getSearchContext(e){if(!this._search?.queryFilters.files||null==e)return;let t=this._search.results.get(e);return{query:this._search.query,queryFilters:this._search.queryFilters,matchedFiles:t?.files??[]}}onConfigurationChanged(e){(z.H.changed(e,"graph.showDetailsView")&&(this._showDetailsView=z.H.get("graph.showDetailsView")),z.H.changed(e,"graph.commitOrdering"))?this.updateState():(z.H.changed(e,"advanced.abbreviatedShaLength")||z.H.changed(e,"ai.enabled")||z.H.changed(e,"defaultDateFormat")||z.H.changed(e,"defaultDateStyle")||z.H.changed(e,"graph"))&&(this.notifyDidChangeConfiguration(),(z.H.changed(e,"graph.onlyFollowFirstParent")||(z.H.changed(e,"graph.minimap.enabled")||z.H.changed(e,"graph.minimap.dataType"))&&z.H.get("graph.minimap.enabled")&&"lines"===z.H.get("graph.minimap.dataType")&&!this._graph?.includes?.stats)&&this.updateState())}onContextChanged(e){["gitlens:gk:organization:ai:enabled","gitlens:gk:organization:drafts:enabled"].includes(e)&&this.notifyDidChangeOrgSettings()}getOrgSettings(){return{ai:(0,$.SD)("gitlens:gk:organization:ai:enabled",!0),drafts:(0,$.SD)("gitlens:gk:organization:drafts:enabled",!1)}}onFeaturePreviewChanged(e){"graph"===e.feature&&this.notifyDidStartFeaturePreview(e)}getFeaturePreview(){return this.container.subscription.getFeaturePreview("graph")}onRepositoryChanged(e){if(!e.changed(P.Z_.Config,P.Z_.Head,P.Z_.Heads,P.Z_.Remotes,P.Z_.Starred,P.Z_.Stash,P.Z_.PausedOperationStatus,P.Z_.Tags,P.Z_.Unknown,P.Ti.Any)){this._etagRepository=e.repository.etag;return}if(e.changed(P.Z_.Config,P.Ti.Any)&&null!=this._refsMetadata)for(let[,e]of this._refsMetadata)null!=e&&(e.issue=void 0);e.changed(P.Z_.Head,P.Ti.Any)&&this.setSelectedRows(void 0),this.updateState(!e.changed(P.Z_.Unknown,P.Ti.Exclusive))}onRepositoryFileSystemChanged(e){e.repository.id===this.repository?.id&&this.notifyDidChangeWorkingTree()}onSubscriptionChanged(e){e.etag!==this._etagSubscription&&(this._etagSubscription=e.etag,this.notifyDidChangeSubscription())}onStorageChanged(e){!e.workspace&&e.keys.includes("mcp:banner:dismissed")&&this.onMcpBannerChanged()}onMcpBannerChanged(){this.host.visible&&this.host.notify(e$,this.getMcpBannerCollapsed())}getMcpBannerCollapsed(){return!(0,q.W$)(this.container)}onThemeChanged(e){null!=this._theme&&((0,N.g4)(e)&&(0,N.g4)(this._theme)||(0,N.kH)(e)&&(0,N.kH)(this._theme))||(this._theme=e,this.updateState())}onColumnsChanged(e){this.updateColumns(e.config);let t={...this.getTelemetryContext()};for(let[i,r]of Object.entries(e.config))for(let[e,s]of Object.entries(r))t[`column.${i}.${e}`]=s;this.container.telemetry.sendEvent("graph/columns/changed",t)}onRefsVisibilityChanged(e){this.updateExcludedRefs(this._graph?.repoPath,e.refs,e.visible)}onDoubleClick(e){if("ref"===e.type&&e.ref.context){let t=this.getGraphItemContext(e.ref.context);if(ep(t)){if(null!=e.metadata){if(t=this.getGraphItemContext(e.metadata.data.context),"upstream"===e.metadata.type&&el(t,"upstreamStatus")){let{ahead:e,behind:i,ref:r}=t.webviewItemValue;if(i>0)return void u.a$(r.repoPath,r);if(e>0)return void u.VC(r.repoPath,!1,r)}else if("pullRequest"===e.metadata.type&&el(t,"pullrequest"))return void this.openPullRequestOnRemote(t);else if("issue"===e.metadata.type&&el(t,"issue"))return void this.openIssueOnRemote(t);return}let{ref:i}=t.webviewItemValue;return"head"===e.ref.refType&&e.ref.isCurrentHead?u.S_(i.repoPath):u.S_(i.repoPath,i,!!z.H.isUnset("gitCommands.skipConfirmations")||void 0)}}else if("row"===e.type&&e.row){this._showActiveSelectionDetailsDebounced?.cancel();let t=this.getRevisionReference(this.repository?.path,e.row.id,e.row.type);if(null!=t){let i=this.getSearchContext(e.row.id);this.container.events.fire("commit:selected",{commit:t,interaction:"active",preserveFocus:e.preserveFocus,preserveVisibility:!1,searchContext:i},{source:this.host.id});let r=this.host.is("editor")?this.container.views.commitDetails:this.container.views.graphDetails;r.ready||r.show({preserveFocus:e.preserveFocus},{commit:t,interaction:"active",preserveVisibility:!1,searchContext:i})}}return Promise.resolve()}async onHoverRowRequest(e,t){let i={id:t.params.id,markdown:void 0};if(this.cancelOperation("hover"),null!=this._graph){let e=t.params.id,r=this._hoverCache.get(e);if(null==r){let i,s=this.createCancellation("hover"),a=!0;try{let e=this.container.git.getRepositoryService(this._graph.repoPath);switch(t.params.type){case"work-dir-changes":a=!1,i=await e.commits.getCommit(W.SU,s.token);break;case"stash-node":{let r=await e.stash?.getStash(void 0,s.token);i=r?.stashes.get(t.params.id);break}default:i=await e.commits.getCommit(t.params.id,s.token)}}catch(e){if(!(e instanceof n.AL))throw e}if(null!=i&&!s.token.isCancellationRequested){let t=this._graph.rowsStats?.get(i.sha);null!=t&&(i=i.with({stats:{...i.stats,additions:t.additions,deletions:t.deletions,files:i.stats?.files?i.stats.files:t.files}})),r=this.getCommitTooltip(i,s.token).catch(t=>{throw this._hoverCache.delete(e),t}),a&&this._hoverCache.set(e,r)}}if(null!=r)try{i.markdown={status:"fulfilled",value:await r}}catch(e){i.markdown={status:"rejected",reason:e}}}i.markdown??={status:"rejected",reason:new n.AL},this.host.respond(e,t,i)}async getCommitTooltip(e,t){let i,r,s,a=this.container.git.getRepositoryService(e.repoPath),[o,h]=await Promise.allSettled([a.remotes.getBestRemotesWithProviders(),e.ensureFullDetails({include:{stats:!0}})]);if(t.isCancellationRequested)throw new n.AL;let l=(0,X.Ro)(o,[]),[p]=l;if(p?.supportsIntegration()){let[s,a]=await Promise.allSettled([(0,X.zu)(e.getEnrichedAutolinks(p),t),e.getAssociatedPullRequest(p)]);if(t.isCancellationRequested)throw new n.AL;let o=(0,X.Ro)(s);o?.paused||(i=o?.value),r=(0,X.Ro)(a)}return s=(0,b.kk)(e)?z.H.get("views.formats.stashes.tooltip"):z.H.get("views.formats.commits.tooltip"),this._getBranchesAndTagsTips??=await a.getBranchesAndTagsTipsLookup(),await y.c.fromTemplateAsync(s,e,{enrichedAutolinks:i,dateFormat:z.H.get("defaultDateFormat"),getBranchAndTagTips:this._getBranchesAndTagsTips,messageAutolinks:!0,messageIndent:4,pullRequest:r,outputFormat:"markdown",remotes:l})}async onEnsureRowRequest(e,t){let i;if(null==this._graph)return;let r=t.params;this._graph.ids.has(r.id)?i=r.id:(await this.updateGraphWithMoreRows(this._graph,r.id,this._search),this.notifyDidChangeRows(),this._graph.ids.has(r.id)&&(i=r.id)),this.host.respond(e,t,{id:i})}async onGetMissingAvatars(e){if(null==this._graph)return;let t=this._graph.repoPath;async function i(e,i){let r=await (0,s.m_)(e,{ref:i,repoPath:t});this._graph.avatars.set(e,r.toString(!0))}let r=[];for(let[t,s]of Object.entries(e.emails))this._graph.avatars.has(t)||r.push(i.call(this,t,s));r.length&&(await Promise.allSettled(r),this.updateAvatars())}async onGetMissingRefMetadata(e){if(null==this._graph||null===this._refsMetadata||!(0,$.SD)("gitlens:repos:withHostingIntegrationsConnected")?.includes(this._graph.repoPath))return;let t=this._graph.repoPath;async function i(e,i){null==this._refsMetadata&&(this._refsMetadata=new Map);let r=(await this.container.git.getRepositoryService(t).branches.getBranches({filter:t=>t.id===e}))?.values?.[0],s={...this._refsMetadata.get(e)};if(null==r){for(let t of i)s[t]=null,this._refsMetadata.set(e,s);return}for(let a of i){if(!eu.includes(a)){s[a]=null,this._refsMetadata.set(e,s);continue}if("pullRequest"===a){let i=await r?.getAssociatedPullRequest();if(null==i){(void 0===s.pullRequest||s.pullRequest?.length===0)&&(s.pullRequest=null),this._refsMetadata.set(e,s);continue}let a=function(e){switch(e){case"github":case"github":case ea.$r.GitHub:return"github";case"cloud-github-enterprise":case"githubEnterprise":case ea.RR.CloudGitHubEnterprise:return"githubEnterprise";case"gitlab":case"gitlab":case ea.$r.GitLab:return"gitlab";case"cloud-gitlab-self-hosted":case"gitlabSelfHosted":case ea.RR.CloudGitLabSelfHosted:return"gitlabSelfHosted";case"azure-devops":case"azureDevops":case"azure":case ea.$r.AzureDevOps:case ea.RR.AzureDevOpsServer:return"azureDevops";case"bitbucket":case"bitbucket":case ea.$r.Bitbucket:return"bitbucket";case"bitbucket-server":case"bitbucketServer":case ea.RR.BitbucketServer:return"bitbucketServer";default:return}}(i.provider.id);if(null==a)continue;s.pullRequest=[{hostingServiceType:a,id:Number.parseInt(i.id)||0,title:i.title,author:i.author.name,date:(i.mergedDate??i.closedDate??i.updatedDate)?.getTime(),state:i.state,url:i.url,context:(0,et.C9)({webviewItem:`gitlens:pullrequest${i.refs?"+refs":""}`,webviewItemValue:{type:"pullrequest",id:i.id,url:i.url,repoPath:t,refs:i.refs,provider:{id:i.provider.id,name:i.provider.name,domain:i.provider.domain,icon:i.provider.icon}}})}],this._refsMetadata.set(e,s),r?.upstream?.missing&&this._refsMetadata.set((0,M.Yk)(t,!0,r.upstream.name),s);continue}if("upstream"===a){let t=r?.upstream;if(null==t||t.missing){s.upstream=null,this._refsMetadata.set(e,s);continue}s.upstream={name:(0,M.km)(t.name),owner:(0,M.Zq)(t.name),ahead:r.upstream?.state.ahead??0,behind:r.upstream?.state.behind??0,context:(0,et.C9)({webviewItem:"gitlens:upstreamStatus",webviewItemValue:{type:"upstreamStatus",ref:(0,T.iw)(r),ahead:r.upstream?.state.ahead??0,behind:r.upstream?.state.behind??0}})},this._refsMetadata.set(e,s);continue}if("issue"===a){let t=await (0,_.GI)(this.container,r).then(e=>e.value);if(!t?.length&&(t=await r.getEnrichedAutolinks().then(async e=>{if(null!=e)return(await Promise.all([...e.values()].map(async([e])=>null!=e?await e:void 0))).filter(e=>null!=e&&e instanceof Object&&"type"in e&&"issue"===e.type)}),!t?.length)){s.issue=null,this._refsMetadata.set(e,s);continue}let i=[];for(let e of t){let t=function(e){switch(e){case"github":case"github":case ea.$r.GitHub:return"github";case"cloud-github-enterprise":case"githubEnterprise":case ea.RR.CloudGitHubEnterprise:return"githubEnterprise";case"gitlab":case"gitlab":case ea.$r.GitLab:return"gitlab";case"cloud-gitlab-self-hosted":case"gitlabSelfHosted":case ea.RR.CloudGitLabSelfHosted:return"gitlabSelfHosted";case"azure-devops":case"azureDevops":case"azure":case ea.$r.AzureDevOps:return"azureDevops";case"bitbucket":case"bitbucket":case ea.$r.Bitbucket:return"bitbucket";case ea.NN.Jira:return"jiraCloud";case ea.NN.Linear:return"linear";default:return}}(e.provider.id);null!=t&&i.push({issueTrackerType:t,displayId:e.id,id:e.nodeId??e.id,title:`${e.title}
Double-click to open issue on ${e.provider.name}`,context:(0,et.C9)({webviewItem:"gitlens:issue",webviewItemValue:{type:"issue",id:e.id,url:e.url,provider:{id:e.provider.id,name:e.provider.name,domain:e.provider.domain,icon:e.provider.icon}}})})}s.issue=i,this._refsMetadata.set(e,s)}}}let r=[];for(let t of Object.keys(e.metadata))r.push(i.call(this,t,e.metadata[t]));r.length&&await Promise.allSettled(r),this.updateRefsMetadata()}async onGetMoreRows(e,t=!1){if(this._graph?.paging!=null){if(this._graph?.more==null||this.repository?.etag!==this._etagRepository)return void this.updateState(!0);await this.updateGraphWithMoreRows(this._graph,e.id,this._search),this.notifyDidChangeRows(t)}}async onOpenPullRequestDetails(e){let t=this.repository;if(null==t)return;let i=await t.git.branches.getBranch();if(null==i)return;let r=await i.getAssociatedPullRequest();if(null!=r)return this.container.views.pullRequest.showPullRequest(r,i)}onSearchHistoryGetRequest(e,t){this._searchHistory??=new SearchHistory(this.container.storage,this.repository?.path);try{this.host.respond(e,t,{history:this._searchHistory.get()})}catch{this.host.respond(e,t,{history:[]})}}async onSearchHistoryStoreRequest(e,t){this._searchHistory??=new SearchHistory(this.container.storage,this.repository?.path);try{await this._searchHistory.store(t.params.search)}finally{this.host.respond(e,t,{history:this._searchHistory.get()})}}async onSearchHistoryDeleteRequest(e,t){this._searchHistory??=new SearchHistory(this.container.storage,this.repository?.path);try{await this._searchHistory.delete(t.params.query)}finally{this.host.respond(e,t,{history:this._searchHistory.get()})}}async onSearchRequest(e,t){var i,r,s,a,o,h=[];try{let i,r,s=((e,t,i)=>{if(null!=t){var r,s;let i,a;"object"!=typeof t&&"function"!=typeof t&&e3("Object expected"),void 0===r&&(r=t[i="dispose",(a=Symbol[i])?a:Symbol.for("Symbol."+i)]),"function"!=typeof r&&e3("Object not disposable"),s&&(r=function(){try{s.call(this)}catch(e){return Promise.reject(e)}}),e.push([void 0,r,t])}return t})(h,new ee.e(`GraphWebviewProvider.onSearchRequest(${this.host.id})`));t.params.search?.naturalLanguage&&(t.params.search=await (0,k.I)(this.container,t.params.search,{source:"graph"}));let a=t.params.search?(0,S.OM)(t.params.search):void 0,o=null!=a?(0,J.fj)(a.operations.keys(),","):"";try{i=await this.getSearchResults(t.params),this.host.respond(e,t,i)}catch(i){r=i,this.host.respond(e,t,{search:t.params.search,results:(0,n.MB)(i)?void 0:{error:i instanceof w.Do?"Invalid search pattern":"Unexpected error"}})}finally{let e=(0,n.MB)(r);this.container.telemetry.sendEvent("graph/searched",{...this.getTelemetryContext(),types:o,duration:s.elapsed(),matches:i?.results?.count??0,failed:null!=r,"failed.reason":null!=r?e?"cancelled":"error":void 0,"failed.error":e||null==r?void 0:String(r),"failed.error.detail":e||r?.original==null?void 0:String(r?.original)})}}catch(e){var l=e,p=!0}finally{i=l,r=p,s="function"==typeof SuppressedError?SuppressedError:function(e,t,i,r){return(r=Error(i)).name="SuppressedError",r.error=e,r.suppressed=t,r},a=e=>i=r?new s(e,i,"An error was suppressed during disposal"):(r=!0,e),(o=e=>{for(;e=h.pop();)try{var t=e[1]&&e[1].call(e[2]);if(e[0])return Promise.resolve(t).then(o,e=>(a(e),o()))}catch(e){a(e)}if(r)throw i})()}}async getSearchResults(e){if(null==e.search)return this.resetSearchState(),{search:e.search,results:void 0};let t=this._search,i=this._graph;if(e.more&&t?.more!=null&&t.comparisonKey===(0,S.b4)(e.search))return null!=(t=await t.more(e.limit??z.H.get("graph.searchItemLimit")??100))?(this._search=t,await this.ensureSearchStartsInRange(i,t),{search:e.search,results:t.results.size?{ids:Object.fromEntries(t.results),count:t.results.size,paging:{hasMore:t.paging?.hasMore??!1}}:void 0}):{search:e.search,results:void 0};if(t?.comparisonKey!==(0,S.b4)(e.search)){if(null==this.repository)return{search:e.search,results:{error:"No repository"}};this.repository.etag!==this._etagRepository&&this.updateState(!0);let i=this.createCancellation("search");try{t=await this.repository.git.graph.searchGraph(e.search,{limit:z.H.get("graph.searchItemLimit")??100,ordering:z.H.get("graph.commitOrdering")},i.token)}catch(e){throw this._search=void 0,e}if(i.token.isCancellationRequested)throw new n.AL;this._search=t}else t=this._search;let r=await this.ensureSearchStartsInRange(i,t),s=!1;for(null!=r&&(s=!0,this.setSelectedRows(r));t.paging?.hasMore&&null!=t.more&&t.results.size&&i.ids.has((0,J.HV)(t.results.keys()));){let e=await t.more(z.H.get("graph.searchItemLimit")??100);null!=e&&(this._search=t=e,await this.ensureSearchStartsInRange(i,t))}return{search:e.search,results:t.results.size?{ids:Object.fromEntries(t.results),count:t.results.size,paging:{hasMore:t.paging?.hasMore??!1}}:{count:0},selectedRows:s?this._selectedRows:void 0}}onSearchOpenInView(e){null!=this.repository&&this.container.views.searchAndCompare.search(this.repository.path,e.search,{label:{label:`for ${e.search.query}`},reveal:{select:!0,focus:!1,expand:!0}})}async onChooseRepository(){let{title:e,placeholder:t}=await (0,L.Nt)(this.container.git.openRepositories,"Switch",this.repository?.name),i=await (0,L.oe)(this.container,e,t,this.container.git.openRepositories,{picked:this.repository});null!=i&&(this.repository=i,this.container.telemetry.sendEvent("graph/repository/changed",{...this.getTelemetryContext(),"repository.id":this.repository?.idHash,"repository.scheme":this.repository?.uri.scheme,"repository.closed":this.repository?.closed,"repository.folder.scheme":this.repository?.folder?.uri.scheme,"repository.provider.id":this.repository?.provider.id}))}async onChooseRef(e,t){if(null==this.repository)return this.host.respond(e,t,void 0);let i=await (0,F.NZ)(this.repository.path,t.params.title,t.params.placeholder,{include:t.params.include??F.m7.BranchesAndTags});return this.host.respond(e,t,i?.sha!=null?{id:i.id,name:i.name,sha:i.sha,refType:i.refType,graphRefType:ti(i)}:void 0)}async onJumpToHead(e,t){if(null==this.repository)return this.host.respond(e,t,void 0);let i=(0,J.I6)(this._graph.branches.values(),e=>e.current);return null==i&&(i=await this.repository.git.branches.getBranch()),this.host.respond(e,t,i?.sha!=null?{id:i.id,name:i.name,sha:i.sha,refType:i.refType,graphRefType:ti(i)}:void 0)}_fireSelectionChangedDebounced=void 0;_lastUserSelectionTime=0;onSelectionChanged(e){this._showActiveSelectionDetailsDebounced?.cancel();let t=e.selection[0];this.setSelectedRows(t?.id),this._lastUserSelectionTime=Date.now(),this._fireSelectionChangedDebounced??=(0,Z.s)(this.fireSelectionChanged.bind(this),50),this._fireSelectionChangedDebounced(t?.id,t?.type)}fireSelectionChanged(e,t){if(null==this.repository)return;let i=this.getRevisionReference(this.repository.path,e,t),r=null!=i?[i]:void 0;this._selection=r,null==r||(!(!this._firstSelection&&this.host.is("editor"))||this.host.active)&&(this.container.events.fire("commit:selected",{commit:r[0],interaction:"passive",preserveFocus:!0,preserveVisibility:this._firstSelection?!1===this._showDetailsView:"selection"!==this._showDetailsView,searchContext:this.getSearchContext(e)},{source:this.host.id}),this._firstSelection=!1)}_notifyDidChangeStateDebounced=void 0;getRevisionReference(e,t,i){if(null!=e&&null!=t)switch(i){case"stash-node":return(0,x.kA)(t,e,{refType:"stash",name:t,number:void 0});case"work-dir-changes":return(0,x.kA)(W.SU,e,{refType:"revision"});default:return(0,x.kA)(t,e,{refType:"revision"})}}updateState(e=!1){(this.host.clearPendingIpcNotifications(),e)?this.notifyDidChangeState():(this._notifyDidChangeStateDebounced??=(0,Z.s)(this.notifyDidChangeState.bind(this),250),this._notifyDidChangeStateDebounced())}_notifyDidChangeAvatarsDebounced=void 0;updateAvatars(e=!1){e?this.notifyDidChangeAvatars():(null==this._notifyDidChangeAvatarsDebounced&&(this._notifyDidChangeAvatarsDebounced=(0,Z.s)(this.notifyDidChangeAvatars.bind(this),100)),this._notifyDidChangeAvatarsDebounced())}async notifyDidChangeAvatars(){if(null==this._graph)return;let e=this._graph;return this.host.notify(ez,{avatars:Object.fromEntries(e.avatars)})}async notifyDidChangeBranchState(e){return this.host.notify(eN,{branchState:e})}_notifyDidChangeRefsMetadataDebounced=void 0;updateRefsMetadata(e=!1){e?this.notifyDidChangeRefsMetadata():(null==this._notifyDidChangeRefsMetadataDebounced&&(this._notifyDidChangeRefsMetadataDebounced=(0,Z.s)(this.notifyDidChangeRefsMetadata.bind(this),100)),this._notifyDidChangeRefsMetadataDebounced())}async notifyDidChangeRefsMetadata(){return this.host.notify(eU,{metadata:null!=this._refsMetadata?Object.fromEntries(this._refsMetadata):this._refsMetadata})}async notifyDidChangeColumns(){if(!this.host.ready||!this.host.visible)return this.host.addPendingIpcNotification(ej,this._ipcNotificationMap,this),!1;let e=this.getColumns(),t=this.getColumnSettings(e);return this.host.notify(ej,{columns:t,context:this.getColumnHeaderContext(t),settingsContext:this.getGraphSettingsIconContext(t)})}async notifyDidChangeScrollMarkers(){if(!this.host.ready||!this.host.visible)return this.host.addPendingIpcNotification(eY,this._ipcNotificationMap,this),!1;let e=this.getColumns(),t=this.getColumnSettings(e);return this.host.notify(eY,{context:this.getGraphSettingsIconContext(t)})}async notifyDidChangeRefsVisibility(e){if(!this.host.ready||!this.host.visible)return this.host.addPendingIpcNotification(eQ,this._ipcNotificationMap,this),!1;if(null==e){let t=this.getFiltersByRepo(this._graph?.repoPath);if(e={branchesVisibility:this.getBranchesVisibility(t),excludeRefs:this.getExcludedRefs(t,this._graph)??{},excludeTypes:this.getExcludedTypes(t)??{},includeOnlyRefs:void 0},e?.includeOnlyRefs==null){let i=await this.getIncludedRefs(t,this._graph,{timeout:100});e.includeOnlyRefs=i.refs,i.continuation?.then(t=>{null!=t&&this.notifyDidChangeRefsVisibility({...e,includeOnlyRefs:t})})}}return this.host.notify(eQ,e)}async notifyDidChangeConfiguration(){return this.host.ready&&this.host.visible?this.host.notify(eF,{config:this.getComponentConfig()}):(this.host.addPendingIpcNotification(eF,this._ipcNotificationMap,this),!1)}async notifyDidFetch(){if(!this.host.ready||!this.host.visible)return this.host.addPendingIpcNotification(e1,this._ipcNotificationMap,this),!1;let e=await this.repository.getLastFetched();return this.host.notify(e1,{lastFetched:new Date(e)})}async notifyDidChangeRows(e=!1,t){if(null==this._graph)return;let i=this._graph;return this.host.notify(eZ,{rows:i.rows,avatars:Object.fromEntries(i.avatars),downstreams:Object.fromEntries(i.downstreams),refsMetadata:null!=this._refsMetadata?Object.fromEntries(this._refsMetadata):this._refsMetadata,rowsStats:i.rowsStats?.size?Object.fromEntries(i.rowsStats):void 0,rowsStatsLoading:i.rowsStatsDeferred?.isLoaded!=null&&!i.rowsStatsDeferred.isLoaded(),selectedRows:e?this._selectedRows:void 0,paging:{startingCursor:i.paging?.startingCursor,hasMore:i.paging?.hasMore??!1}},t)}async notifyDidChangeRowsStats(e){if(null!=e.rowsStats)return this.host.notify(eJ,{rowsStats:Object.fromEntries(e.rowsStats),rowsStatsLoading:e.rowsStatsDeferred?.isLoaded!=null&&!e.rowsStatsDeferred.isLoaded()})}async notifyDidStartFeaturePreview(e){if(!this.host.ready||!this.host.visible)return this.host.addPendingIpcNotification(e2,this._ipcNotificationMap,this),!1;e??=this.getFeaturePreview();let[t]=await this.getGraphAccess();return this.host.notify(e2,{featurePreview:e,allowed:this.isGraphAccessAllowed(t,e)})}async notifyDidChangeWorkingTree(e){return this.host.ready&&this.host.visible?this.host.notify(eX,{stats:await this.getWorkingTreeStats(e)??{added:0,deleted:0,modified:0}}):(this.host.addPendingIpcNotification(eX,this._ipcNotificationMap,this),!1)}async notifyDidChangeSelection(){return this.host.ready&&this.host.visible?this.host.notify(eK,{selection:this._selectedRows??{}}):(this.host.addPendingIpcNotification(eK,this._ipcNotificationMap,this),!1)}async notifyDidChangeSubscription(){if(!this.host.ready||!this.host.visible)return this.host.addPendingIpcNotification(eL,this._ipcNotificationMap,this),!1;let[e]=await this.getGraphAccess();return this.host.notify(eL,{subscription:e.subscription.current,allowed:this.isGraphAccessAllowed(e,this.getFeaturePreview())})}notifyDidChangeOrgSettings(){this.host.notify(eE,{orgSettings:this.getOrgSettings()})}async notifyDidChangeState(){return this.host.ready&&this.host.visible?(this._notifyDidChangeStateDebounced?.cancel(),this.host.notify(eA,{state:await this.getState()})):(this.host.addPendingIpcNotification(eA,this._ipcNotificationMap,this),!1)}ensureRepositorySubscriptions(e){if(this.ensureLastFetchedSubscription(e),!e&&null!=this._repositoryEventsDisposable)return;null!=this._repositoryEventsDisposable&&(this._repositoryEventsDisposable.dispose(),this._repositoryEventsDisposable=void 0);let t=this.repository;null!=t&&(this._repositoryEventsDisposable=r.Disposable.from(t.onDidChange(this.onRepositoryChanged,this),t.watchFileSystem(1e3),t.onDidChangeFileSystem(this.onRepositoryFileSystemChanged,this),(0,$.wt)(e=>{"gitlens:repos:withHostingIntegrationsConnected"===e&&(this.resetRefsMetadata(),this.updateRefsMetadata())})))}onIntegrationConnectionChanged(e){this.notifyDidChangeRepoConnection()}async notifyDidChangeRepoConnection(){this.host.notify(eq,{repositories:await this.getRepositoriesState()})}async getRepositoriesState(){return en(this.container.git.openRepositories)}async ensureLastFetchedSubscription(e){if(!e&&null!=this._lastFetchedDisposable)return;null!=this._lastFetchedDisposable&&(this._lastFetchedDisposable.dispose(),this._lastFetchedDisposable=void 0);let t=this.repository;if(null==t)return;let i=await t.getLastFetched()??0,r=(0,O.u)(i);0!==i&&r>0&&(this._lastFetchedDisposable=(0,Q.gC)(()=>{let e=(0,O.u)(i);r!==(0,O.u)(i)&&(r=e),this.notifyDidFetch()},r))}async ensureSearchStartsInRange(e,t){let i;if(0!==t.results.size){for(let r of t.results.keys()){if(e.ids.has(r))return r;i=r;break}if(null!=i)return await this.updateGraphWithMoreRows(e,i),this.notifyDidChangeRows(),e.ids.has(i)?i:void 0}}getColumns(){return this.container.storage.getWorkspace("graph:columns")}getExcludedTypes(e){return e?.excludeTypes}getExcludedRefs(e,t){if(null==t)return;let i=e?.excludeRefs;if(!(0,K.xV)(i))return;let r=e=>this.host.asWebviewUri(e),s=z.H.get("graph.avatars",void 0,!0),a={};for(let e in i){let o={...i[e]};if("remote"===o.type&&o.owner){let e=t.remotes.get(o.owner);null!=e&&(o.avatarUrl=((s?e.provider?.avatarUri:void 0)??(0,G.Wf)(this.container,e,r))?.toString(!0))}a[e]=o}return a}async getIncludedRefs(e,t,i){let r,s;if(this.cancelOperation("computeIncludedRefs"),null==t)return{refs:{}};switch(this.getBranchesVisibility(e)){case"smart":{let e,a=(0,J.I6)(t.branches.values(),e=>e.current);if(null==a)return{refs:{},continuation:s};let o=this.createCancellation("computeIncludedRefs"),n=await (0,D.Y7)(this.container,a,{cancellation:o.token,timeout:i?.timeout});if(o.token.isCancellationRequested)return{refs:{},continuation:s};n.mergeTargetBranch?.paused?s=n.mergeTargetBranch.value.then(async e=>{if(!(null==e||o?.token.isCancellationRequested))return Object.fromEntries(await this.getVisibleRefs(t,a,{baseOrTargetBranchName:e,defaultBranchName:n.defaultBranch}))}):e=n.mergeTargetBranch?.value,r=await this.getVisibleRefs(t,a,{baseOrTargetBranchName:e??n.baseBranch,defaultBranchName:n.defaultBranch});break}case"current":{let e=(0,J.I6)(t.branches.values(),e=>e.current);if(null==e)return{refs:{},continuation:s};r=await this.getVisibleRefs(t,e);break}case"favorited":{let e=(0,D.YV)(this.container);if(!e.size)return{refs:{},continuation:s};for(let i of(r=new Map,t.branches.values()))(i.current||e.has(i.id))&&r.set(i.id,te(i))}}return{refs:null==r?{}:Object.fromEntries(r),continuation:s}}getFiltersByRepo(e){if(null==e)return;let t=this.container.storage.getWorkspace("graph:filtersByRepo");return t?.[e]}getColumnSettings(e){let t={...e8};if(null!=e)for(let[i,r]of Object.entries(e))t[i]={...e8[i],...r};return t}getColumnHeaderContext(e){return(0,et.C9)({webviewItem:"gitlens:graph:columns",webviewItemValue:this.getColumnContextItems(e).join(",")})}getGraphSettingsIconContext(e){return(0,et.C9)({webviewItem:"gitlens:graph:settings",webviewItemValue:this.getSettingsIconContextItems(e).join(",")})}getColumnContextItems(e){let t=[],i=["author","changes","datetime","graph","message","ref","sha"],r=0;for(let[s,a]of Object.entries(e))i.includes(s)&&(!a.isHidden&&r++,t.push(`column:${s}:${a.isHidden?"hidden":"visible"}${a.mode?`+${a.mode}`:""}`));return r>1&&t.push("columns:canHide"),t}getSettingsIconContextItems(e){let t=null!=e?this.getColumnContextItems(e):[];if(z.H.get("graph.scrollMarkers.enabled")){let e=z.H.get("graph.scrollMarkers.additionalTypes");for(let i of["localBranches","remoteBranches","stashes","tags","pullRequests"])t.push(`scrollMarker:${i}:${e.includes(i)?"enabled":"disabled"}`)}return t}getBranchesVisibility(e){let t;return this.repository?.virtual?"current":null==e?z.H.get("graph.branchesVisibility"):(null!=e&&null==e.branchesVisibility&&null!=e.includeOnlyRefs&&1===Object.keys(e.includeOnlyRefs).length&&"HEAD"===Object.values(e.includeOnlyRefs)[0].name?(t="current",null!=this.repository&&this.updateFiltersByRepo(this.repository.path,{branchesVisibility:t,includeOnlyRefs:void 0})):t=e?.branchesVisibility??z.H.get("graph.branchesVisibility"),t)}getComponentConfig(){return{aiEnabled:z.H.get("ai.enabled"),avatars:z.H.get("graph.avatars"),dateFormat:z.H.get("graph.dateFormat")??z.H.get("defaultDateFormat")??"short+short",dateStyle:z.H.get("graph.dateStyle")??z.H.get("defaultDateStyle"),enabledRefMetadataTypes:this.getEnabledRefMetadataTypes(),dimMergeCommits:z.H.get("graph.dimMergeCommits"),highlightRowsOnRefHover:z.H.get("graph.highlightRowsOnRefHover"),idLength:z.H.get("advanced.abbreviatedShaLength"),minimap:z.H.get("graph.minimap.enabled"),minimapDataType:z.H.get("graph.minimap.dataType"),minimapMarkerTypes:this.getMinimapMarkerTypes(),multiSelectionMode:z.H.get("graph.multiselect"),onlyFollowFirstParent:z.H.get("graph.onlyFollowFirstParent"),scrollRowPadding:z.H.get("graph.scrollRowPadding"),scrollMarkerTypes:this.getScrollMarkerTypes(),showGhostRefsOnRowHover:z.H.get("graph.showGhostRefsOnRowHover"),showRemoteNamesOnRefs:z.H.get("graph.showRemoteNames"),sidebar:z.H.get("graph.sidebar.enabled")??!0}}getScrollMarkerTypes(){return z.H.get("graph.scrollMarkers.enabled")?["selection","highlights","head","upstream",...z.H.get("graph.scrollMarkers.additionalTypes")]:[]}getMinimapMarkerTypes(){return z.H.get("graph.minimap.enabled")?["selection","highlights","head","upstream",...z.H.get("graph.minimap.additionalTypes")]:[]}getEnabledRefMetadataTypes(){let e=[];return z.H.get("graph.issues.enabled")&&e.push("issue"),z.H.get("graph.pullRequests.enabled")&&e.push("pullRequest"),z.H.get("graph.showUpstreamStatus")&&e.push("upstream"),e}async getGraphAccess(){let e=await this.container.git.access("graph",this.repository?.path);this._etagSubscription=this.container.subscription.etag;let t=e?.visibility;return null==t&&null!=this.repository&&(t=await this.container.git.visibility(this.repository?.path)),[e,t]}isGraphAccessAllowed(e,t){return(e?.allowed??!1)!==!1||"active"===(0,h.Zd)(t)}getGraphItemContext(e){let t="string"==typeof e?JSON.parse(e):e;return null==t||"webview"in t||(t.webview=this.host.id),t}async getWorkingTreeStats(e,t){if(null==this.repository||!this.container.git.repositoryCount)return;let i=this.container.git.getRepositoryService(this.repository.path);e??=await i.status.hasWorkingChanges({staged:!0,unstaged:!0,untracked:!0},t);let[r,s]=await Promise.allSettled([e?i.status.getStatus(t):void 0,i.pausedOps?.getPausedOperationStatus?.(t)]),a=(0,X.Ro)(r),o=a?.getDiffStatus(),n=(0,X.Ro)(s);return{added:o?.added??0,deleted:o?.deleted??0,modified:o?.changed??0,hasConflicts:a?.hasConflicts,pausedOpStatus:n,context:(0,et.C9)({webviewItem:"gitlens:wip",webviewItemValue:{type:"commit",ref:this.getRevisionReference(this.repository.path,W.SU,"work-dir-changes")}})}}async getState(e){let t,i;this.cancelOperation("branchState"),this.cancelOperation("state");let r=this._searchRequest;if(this._searchRequest=void 0,0===this.container.git.repositoryCount||null==this.repository&&(this.repository=this.container.git.getBestRepositoryOrFirst(),null==this.repository))return{...this.host.baseWebviewState,allowed:!0,repositories:[]};let s=this.createCancellation("state");this._etagRepository=this.repository?.etag,this.host.title=`${this.host.originalTitle}: ${this.repository.name}`;let{defaultItemLimit:a}=z.H.get("graph"),o=Math.max(a,this._graph?.ids.size??a),h=await this.repository.git.status.hasWorkingChanges({staged:!0,unstaged:!0,untracked:!0},s.token),l=this._selectedId,p=!1;null==r&&l!==W.SU&&h&&"wip"===z.H.get("graph.initialRowSelection")&&(p=!0,this.setSelectedRows(W.SU),l=this._selectedId);let c=this.getColumns(),g=this.getColumnSettings(c),d=this.repository.git.graph.getGraph(l,e=>this.host.asWebviewUri(e),{include:{stats:z.H.get("graph.minimap.enabled")&&"lines"===z.H.get("graph.minimap.dataType")||!g.changes.isHidden},limit:o},s.token),u=Promise.allSettled([this.getGraphAccess(),h?this.getWorkingTreeStats(h,s.token):void 0,this.repository.git.branches.getBranch(void 0,s.token),this.repository.getLastFetched()]);e?queueMicrotask(async()=>{try{let e=await d;this.setGraph(e),Date.now()-this._lastUserSelectionTime<500||this._selectedId===e.id||(p=!0,this.setSelectedRows(e.id)),this.notifyDidChangeRefsVisibility(),this.notifyDidChangeRows(p)}catch{}}):(t=await d,this.setGraph(t),l!==t.id&&this.setSelectedRows(t.id));let[m,v,f,w]=await u;if(s.token.isCancellationRequested)throw new n.AL;let[y,b]=(0,X.Ro)(m)??[],C=(0,X.Ro)(f);if(null!=C){i={...C.upstream?.state??{ahead:0,behind:0}};let e=t?.worktreesByBranch??await (0,I.Ao)(this.repository,void 0,s.token);if(i.worktree=e?.has(C.id)??!1,null!=C.upstream){i.upstream=C.upstream.name;let e=this.createCancellation("branchState"),[t,r]=await Promise.allSettled([C.getRemote(),(0,X.wW)(C.getAssociatedPullRequest(),e.token,100)]),s=(0,X.Ro)(t);s?.provider!=null&&(i.provider={name:s.provider.name,icon:"remote"===s.provider.icon?"cloud":s.provider.icon,url:await s.provider.url({type:R.J.Repo})});let a=(0,X.Ro)(r);if(a?.paused){let t={...i};a.value.then(i=>{e?.token.isCancellationRequested||null!=i&&(t.pr=(0,B.pf)(i),this.notifyDidChangeBranchState(t))})}else{let e=a?.value;null!=e&&(i.pr=(0,B.pf)(e))}}}let P=this.getFiltersByRepo(this.repository.path),S={branchesVisibility:this.getBranchesVisibility(P),excludeRefs:this.getExcludedRefs(P,t)??{},excludeTypes:this.getExcludedTypes(P)??{},includeOnlyRefs:void 0};if(null!=t){let e=await this.getIncludedRefs(P,t,{timeout:100});S.includeOnlyRefs=e.refs,e.continuation?.then(e=>{null!=e&&this.notifyDidChangeRefsVisibility({...S,includeOnlyRefs:e})})}let k=this.container.storage.get("graph:searchMode","normal"),_=this.container.storage.get("graph:useNaturalLanguageSearch",!0),D=this.getFeaturePreview();return{...this.host.baseWebviewState,webroot:this.host.getWebRoot(),windowFocused:this.isWindowFocused,repositories:await en(this.container.git.openRepositories),selectedRepository:this.repository.path,selectedRepositoryVisibility:b,branchesVisibility:S.branchesVisibility,branch:C&&{name:C.name,ref:C.ref,refType:C.refType,remote:C.remote,repoPath:C.repoPath,sha:C.sha,id:C.id,upstream:C.upstream},branchState:i,lastFetched:new Date((0,X.Ro)(w)),selectedRows:this._selectedRows,subscription:y?.subscription.current,allowed:this.isGraphAccessAllowed(y,D),avatars:null!=t?Object.fromEntries(t.avatars):void 0,refsMetadata:null===this.resetRefsMetadata()?null:{},loading:!0===e,rowsStatsLoading:t?.rowsStatsDeferred?.isLoaded!=null&&!t.rowsStatsDeferred.isLoaded(),rows:t?.rows,downstreams:null!=t?Object.fromEntries(t.downstreams):void 0,paging:null!=t?{startingCursor:t.paging?.startingCursor,hasMore:t.paging?.hasMore??!1}:void 0,columns:g,config:this.getComponentConfig(),context:{header:this.getColumnHeaderContext(g),settings:this.getGraphSettingsIconContext(g)},excludeRefs:S.excludeRefs,excludeTypes:S.excludeTypes,includeOnlyRefs:S.includeOnlyRefs,nonce:this.host.cspNonce,workingTreeStats:(0,X.Ro)(v)??{added:0,deleted:0,modified:0},defaultSearchMode:k,useNaturalLanguageSearch:_,featurePreview:D,orgSettings:this.getOrgSettings(),mcpBannerCollapsed:this.getMcpBannerCollapsed(),searchRequest:r}}updateColumns(e){let t=this.container.storage.getWorkspace("graph:columns");for(let[i,r]of Object.entries(e))t=(0,K.Y8)(t,i,r);this.container.storage.storeWorkspace("graph:columns",t).catch(),this.notifyDidChangeColumns()}updateExcludedRefs(e,t,i){if(null==e||!t?.length)return;let r=this.getFiltersByRepo(e)?.excludeRefs??{};for(let e of t)r=(0,K.Y8)(r,e.id,i?void 0:{id:e.id,type:e.type,name:e.name,owner:e.owner});this.updateFiltersByRepo(e,{excludeRefs:r}),this.notifyDidChangeRefsVisibility()}updateFiltersByRepo(e,t){if(null==e)return;let i=this.container.storage.getWorkspace("graph:filtersByRepo");return this.container.storage.storeWorkspace("graph:filtersByRepo",(0,K.Y8)(i,e,{...i?.[e],...t}))}async getVisibleRefs(e,t,i){let r=new Map([[t.id,te(t)]]),s=tt(t);null==s||r.has(s.id)||r.set(s.id,s);let a=!0,o=i?.baseOrTargetBranchName;if(null!=o&&o!==t?.name){let t=e.branches.get(o);if(null!=t)if(a=!1,t.remote)r.has(t.id)||r.set(t.id,te(t,!0));else{let e=tt(t);null==e||r.has(e.id)||r.set(e.id,e)}}let n=i?.associatedPullRequest;if(n?.refs!=null){let t,i=(0,J.I6)(e.remotes.values(),e=>e.matches(n.refs.base.url));null!=i&&(t=e.branches.get(`${i.name}/${n.refs.base.branch}`)),null!=t&&(a=!1,r.has(t.id)||r.set(t.id,te(t,!0)))}if(a){let s=i?.defaultBranchName;if(null!=s&&s!==t?.name){let t=e.branches.get(s);if(null!=t)if(t.remote){r.has(t.id)||r.set(t.id,te(t,!0));let i=await (0,M.kY)(s,e.branches);null==i||r.has(i.id)||r.set(i.id,te(i,!1))}else{r.has(t.id)||r.set(t.id,te(t,!1));let e=tt(t);null==e||r.has(e.id)||r.set(e.id,e)}}}return r}updateIncludeOnlyRefs(e,{branchesVisibility:t,refs:i}){let r;if(null!=e){if(i?.length)for(let e of(r={},i))r[e.id]={id:e.id,type:e.type,name:e.name,owner:e.owner};else r=void 0;if(null!=t){let i=this.getBranchesVisibility(this.getFiltersByRepo(e));this.container.telemetry.sendEvent("graph/branchesVisibility/changed",{...this.getTelemetryContext(),"branchesVisibility.old":i,"branchesVisibility.new":t})}this.updateFiltersByRepo(e,{branchesVisibility:t,includeOnlyRefs:r}),this.notifyDidChangeRefsVisibility()}}updateExcludedTypes(e,{key:t,value:i}){if(null==e)return;let r=this.getFiltersByRepo(e)?.excludeTypes;((0,K.xV)(r)||!1!==i)&&(r=(0,K.Y8)(r,t,i),this.container.telemetry.sendEvent("graph/filters/changed",{...this.getTelemetryContext(),key:t,value:i}),this.updateFiltersByRepo(e,{excludeTypes:r}),this.notifyDidChangeRefsVisibility())}resetHoverCache(){this._hoverCache.clear(),this.cancelOperation("hover")}resetRefsMetadata(){return this._refsMetadata=(0,$.SD)("gitlens:repos:withHostingIntegrationsConnected")?void 0:null,this._refsMetadata}resetRepositoryState(){this._getBranchesAndTagsTips=void 0,this._searchHistory=void 0,this.setGraph(void 0),this.setSelectedRows(void 0)}resetSearchState(){this._search=void 0,this.cancelOperation("search")}setSelectedRows(e){let t=e;"work-dir-changes"===e&&(t=W.SU),this._selectedId!==t&&(this._selectedId=t,e===W.SU&&(e="work-dir-changes"),this._selectedRows=null!=e?{[e]:!0}:void 0)}setGraph(e){this._graph=e,null==e?(this.resetHoverCache(),this.resetRefsMetadata(),this.resetSearchState(),this.cancelOperation("computeIncludedRefs")):e.rowsStatsDeferred?.promise.then(()=>void this.notifyDidChangeRowsStats(e))}_pendingRowsQuery;async updateGraphWithMoreRows(e,t,i){if(null!=this._pendingRowsQuery){let{id:e,search:r}=this._pendingRowsQuery;if(r===i&&(e===t||null!=e&&null==t))return this._pendingRowsQuery.promise;this._pendingRowsQuery.cancellable.cancel(),this._pendingRowsQuery.cancellable.dispose(),this._pendingRowsQuery=void 0}let s=new ee.e(void 0),a=new r.CancellationTokenSource,o=a.token;return this._pendingRowsQuery={promise:this.updateGraphWithMoreRowsCore(e,t,i,o).catch(e=>{if(!o.isCancellationRequested)throw e}),cancellable:a,id:t,search:i},this._pendingRowsQuery.promise.finally(()=>{o.isCancellationRequested||(this.container.telemetry.sendEvent("graph/rows/loaded",{...this.getTelemetryContext(),duration:s.elapsed(),rows:e.rows.length??0}),s.stop(),this._pendingRowsQuery=void 0)}),this._pendingRowsQuery.promise}async updateGraphWithMoreRowsCore(e,t,i,r){let{defaultItemLimit:s,pageItemLimit:a}=z.H.get("graph"),o=await e.more?.(a??s,t??void 0,r);if(null!=o){if(this.setGraph(o),!i?.paging?.hasMore)return;let e=(0,J.HV)(i.results)?.[0];if(null==e)return;o.ids.has(e)&&queueMicrotask(async()=>{try{let e=await this.getSearchResults({search:i.query,more:!0});this.host.notify(e0,e)}catch(e){if(e instanceof n.AL)return;this.host.notify(e0,{search:i.query,results:{error:e instanceof w.Do?"Invalid search pattern":"Unexpected error"}})}})}}fetch(e){let t=null!=e?this.getGraphItemRef(e,"branch"):void 0;u.hd(this.repository,t)}forcePush(e){this.push(e,!0)}pull(e){let t=null!=e?this.getGraphItemRef(e,"branch"):void 0;u.a$(this.repository,t)}push(e,t){let i=null!=e?this.getGraphItemRef(e):void 0;u.VC(this.repository,t,i)}createBranch(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():p.vt(t.repoPath,t)}deleteBranch(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue;return p.TF(t.repoPath,t)}return Promise.resolve()}async star(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue,i=await this.container.git.getRepositoryService(t.repoPath).branches.getBranch(t.name);if(null!=i)return i.star()}return Promise.resolve()}async unstar(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue,i=await this.container.git.getRepositoryService(t.repoPath).branches.getBranch(t.name);if(null!=i)return i.unstar()}return Promise.resolve()}mergeBranchInto(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue;return u.h1(t.repoPath,t)}return Promise.resolve()}openBranchOnRemote(e,t){if(ep(e,"branch")){let i,{ref:r}=e.webviewItemValue;return r.remote?i=(0,M.Zq)(r.name):null!=r.upstream&&(i=(0,M.Zq)(r.upstream.name)),(0,E.RS)("gitlens.openOnRemote",{repoPath:r.repoPath,resource:{type:R.J.Branch,branch:r.name},remote:i,clipboard:t})}return Promise.resolve()}publishBranch(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue;return u.VC(t.repoPath,void 0,t)}return Promise.resolve()}rebase(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():u.RU(t.repoPath,t)}rebaseToRemote(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue;if(null!=t.upstream)return u.RU(t.repoPath,(0,x.kA)(t.upstream.name,t.repoPath,{refType:"branch",name:t.upstream.name,remote:!0}))}return Promise.resolve()}renameBranch(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue;return p.$w(t.repoPath,t)}return Promise.resolve()}associateIssueWithBranch(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue;return(0,E.RS)("gitlens.associateIssueWithBranch",{command:"associateIssueWithBranch",branch:t,source:"graph"})}return Promise.resolve()}cherryPick(e){let{selection:t}=this.getGraphItemRefs(e,"revision");return null==t?Promise.resolve():u.$T(t[0].repoPath,t)}async copy(e){let t,{selection:i}=this.getGraphItemRefs(e);if(i.length)t=i.map(e=>"revision"===e.refType&&e.message?`${e.name}: ${e.message.trim()}`:e.name).join(`
`);else if(el(e,"contributor")){let{name:i,email:r}=e.webviewItemValue;t=`${i}${r?` <${r}>`:""}`}else if(el(e,"pullrequest")){let{url:i}=e.webviewItemValue;t=i}null!=t&&await r.env.clipboard.writeText(t)}copyMessage(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():(0,E.RS)("gitlens.copyMessageToClipboard",{repoPath:t.repoPath,sha:t.ref,message:"message"in t?t.message:void 0})}async copySha(e){let t=this.getGraphItemRef(e);if(null==t)return Promise.resolve();let i=t.ref;return(0,V.HH)(i)||(i=(await this.container.git.getRepositoryService(t.repoPath).revision.resolveRevision(i)).sha),(0,E.RS)("gitlens.copyShaToClipboard",{sha:i})}openInDetailsView(e){let t=this.getGraphItemRef(e,"revision");return null==t?Promise.resolve():this.host.is("view")?void(0,c.nz)(t,{preserveFocus:!0,preserveVisibility:!1}):(0,E.RS)("gitlens.showInDetailsView",{ref:t})}async commitViaSCM(e){let t=this.getGraphItemRef(e,"revision");if(await (0,E.S4)("workbench.view.scm"),null!=t){let e=await this.container.git.getRepositoryService(t.repoPath).getScmRepository();if(null==e)return;e.inputBox.value=e.inputBox.value}}openCommitOnRemote(e,t){let{selection:i}=this.getGraphItemRefs(e,"revision");return null==i?Promise.resolve():(0,E.RS)("gitlens.openOnRemote",{repoPath:i[0].repoPath,resource:i.map(e=>({type:R.J.Commit,sha:e.ref})),clipboard:t})}async compareSelectedCommits(e){let{selection:t}=this.getGraphItemRefs(e,"revision");if(t?.length!==2)return Promise.resolve();let[i,r]=t,[s,a]=await (0,c.Di)(this.container,i.repoPath,i.ref,r.ref);return this.container.views.searchAndCompare.compare(i.repoPath,s,a)}async abortPausedOperation(e){null!=this.repository&&await (0,d._e)(this.repository.git)}async continuePausedOperation(e){if(null==this.repository)return;let t=await this.repository.git.pausedOps?.getPausedOperationStatus?.();null!=t&&"revert"!==t.type&&await (0,d.Ts)(this.repository.git)}async openRebaseEditor(e){if(null==this.repository)return;let t=await this.repository.git.pausedOps?.getPausedOperationStatus?.();if(t?.type!=="rebase")return;let i=await this.repository.git.config.getGitDir?.();if(null==i)return;let s=r.Uri.joinPath(i.uri,"rebase-merge","git-rebase-todo");(0,E.S4)("vscode.openWith",s,"gitlens.rebase",{preview:!1})}async skipPausedOperation(e){null!=this.repository&&await (0,d.RG)(this.repository.git)}copyDeepLinkToBranch(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue;return(0,E.RS)("gitlens.copyDeepLinkToBranch",{refOrRepoPath:t})}return Promise.resolve()}copyDeepLinkToCommit(e){let t=this.getGraphItemRef(e,"revision");return null==t?Promise.resolve():(0,E.RS)("gitlens.copyDeepLinkToCommit",{refOrRepoPath:t})}copyDeepLinkToRepo(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue;return t.remote?(0,E.RS)("gitlens.copyDeepLinkToRepo",{refOrRepoPath:t.repoPath,remote:(0,M.Zq)(t.name)}):Promise.resolve()}return Promise.resolve()}copyDeepLinkToTag(e){if(ep(e,"tag")){let{ref:t}=e.webviewItemValue;return(0,E.RS)("gitlens.copyDeepLinkToTag",{refOrRepoPath:t})}return Promise.resolve()}async shareAsCloudPatch(e){let t=this.getGraphItemRef(e,"revision")??this.getGraphItemRef(e,"stash");if(null==t)return Promise.resolve();let{summary:i,body:r}=(0,H.TH)(t.message);return(0,E.RS)("gitlens.createCloudPatch",{to:t.ref,repoPath:t.repoPath,title:i,description:r})}async copyPatchToClipboard(e){let t=this.getGraphItemRef(e,"revision")??this.getGraphItemRef(e,"stash");if(null==t)return Promise.resolve();let{summary:i,body:r}=(0,H.TH)(t.message);return(0,E.RS)("gitlens.copyPatchToClipboard",{from:`${t.ref}^`,to:t.ref,repoPath:t.repoPath,title:i,description:r})}resetCommit(e){let t=this.getGraphItemRef(e,"revision");return null==t?Promise.resolve():u.cL(t.repoPath,(0,x.kA)(`${t.ref}^`,t.repoPath,{refType:"revision",name:`${t.name}^`,message:t.message}))}resetToCommit(e){let t=this.getGraphItemRef(e,"revision");return null==t?Promise.resolve():u.cL(t.repoPath,t)}resetToTip(e){let t=this.getGraphItemRef(e,"branch");return null==t?Promise.resolve():u.cL(t.repoPath,(0,x.kA)(t.ref,t.repoPath,{refType:"revision",name:t.name}))}revertCommit(e){let t=this.getGraphItemRef(e,"revision");return null==t?Promise.resolve():u.ru(t.repoPath,t)}switchTo(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():u.S_(t.repoPath,t)}resetToTag(e){let t=this.getGraphItemRef(e,"tag");return null==t?Promise.resolve():u.cL(t.repoPath,t)}hideRef(e,t){let i;if(t?.group&&function(e){return null!=e&&null!=e&&(0,et.PH)(e)&&("gitlens.graph"===e.webview||"gitlens.views.graph"===e.webview)&&"object"==typeof e.webviewItemGroupValue&&"refGroup"===e.webviewItemGroupValue.type}(e))({refs:i}=e.webviewItemGroupValue);else if(!t?.group&&ep(e)){let{ref:t}=e.webviewItemValue;null!=t.id&&(i=[t])}return null!=i&&this.updateExcludedRefs(this._graph?.repoPath,i.map(e=>{let i="branch"===e.refType&&e.remote;return{id:e.id,name:i?t?.remote?"*":(0,M.km)(e.name):e.name,owner:i?(0,M.Zq)(e.name):void 0,type:"branch"===e.refType?e.remote?"remote":"head":"tag"}}),!1),Promise.resolve()}soloReference(e){if(!ep(e))return;let{ref:t}=e.webviewItemValue;if(null==t.id)return;let i=this.container.git.getRepository(t.repoPath);if(null==i)return Promise.resolve();(0,E.RS)("gitlens.showInCommitGraph",{repository:i,search:{query:`ref:${t.name}`,filter:!0,matchAll:!1,matchCase:!1,matchRegex:!1}})}switchToAnother(e){let t=this.getGraphItemRef(e);return null==t?u.S_(this.repository?.path):u.S_(t.repoPath)}async undoCommit(e){let t=this.getGraphItemRef(e,"revision");if(null==t)return Promise.resolve();await (0,c.MQ)(this.container,t)}saveStash(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():m.VC(t.repoPath)}applyStash(e){let t=this.getGraphItemRef(e,"stash");return null==t?Promise.resolve():m.Bb(t.repoPath,t)}deleteStash(e){let t=this.getGraphItemRef(e,"stash");return null==t?Promise.resolve():m.gv(t.repoPath,[t])}renameStash(e){let t=this.getGraphItemRef(e,"stash");return null==t?Promise.resolve():m.$w(t.repoPath,t)}async createTag(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():v.vt(t.repoPath,t)}deleteTag(e){if(ep(e,"tag")){let{ref:t}=e.webviewItemValue;return v.TF(t.repoPath,t)}return Promise.resolve()}async createWorktree(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():f.vt(t.repoPath,void 0,t)}async createPullRequest(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue,i=this.container.git.getRepository(t.repoPath),r=await i?.git.branches.getBranch(t.name),s=await r?.getRemote();return(0,E.ph)("createPullRequest",{repoPath:t.repoPath,remote:null!=s?{name:s.name,provider:null!=s.provider?{id:s.provider.id,name:s.provider.name,domain:s.provider.domain}:void 0,url:s.url}:void 0,branch:{name:t.name,upstream:t.upstream?.name,isRemote:t.remote}})}return Promise.resolve()}openPullRequest(e){if(el(e,"pullrequest")){let t=e.webviewItemValue;return(0,E.ph)("openPullRequest",{repoPath:t.repoPath,provider:{id:t.provider.id,name:t.provider.name,domain:t.provider.domain},pullRequest:{id:t.id,url:t.url}})}return Promise.resolve()}openPullRequestChanges(e){if(el(e,"pullrequest")){let t=e.webviewItemValue;if(t.refs?.base!=null&&null!=t.refs.head){let e=(0,B.tI)(t.repoPath,t.refs);return(0,c.$5)(this.container,{repoPath:e.repoPath,lhs:e.base.ref,rhs:e.head.ref},{title:`Changes in Pull Request #${t.id}`})}}return Promise.resolve()}openPullRequestComparison(e){if(el(e,"pullrequest")){let t=e.webviewItemValue;if(t.refs?.base!=null&&null!=t.refs.head){let e=(0,B.tI)(t.repoPath,t.refs);return this.container.views.searchAndCompare.compare(e.repoPath,e.head,e.base)}}return Promise.resolve()}openPullRequestOnRemote(e,t){if(el(e,"pullrequest")){let{url:i}=e.webviewItemValue;return(0,E.RS)("gitlens.openPullRequestOnRemote",{pr:{url:i},clipboard:t})}return Promise.resolve()}openIssueOnRemote(e){if(el(e,"issue")){let{url:t}=e.webviewItemValue;(0,U.CZ)(t)}return Promise.resolve()}async compareAncestryWithWorking(e){let t=this.getGraphItemRef(e);if(null==t)return Promise.resolve();let i=await this.container.git.getRepositoryService(t.repoPath).branches.getBranch();if(null==i)return;let r=await this.container.git.getRepositoryService(t.repoPath).refs.getMergeBase(i.ref,t.ref);if(null!=r)return this.container.views.searchAndCompare.compare(t.repoPath,"",{ref:r,label:`${i.ref} (${(0,V.pV)(r)})`})}async compareHeadWith(e){let t=this.getGraphItemRef(e);if(null==t)return Promise.resolve();let[i,r]=await (0,c.Di)(this.container,t.repoPath,"HEAD",t.ref);return this.container.views.searchAndCompare.compare(t.repoPath,i,r)}compareBranchWithHead(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():this.container.views.searchAndCompare.compare(t.repoPath,t.ref,"HEAD")}async compareWithMergeBase(e){let t=this.getGraphItemRef(e);if(null==t)return Promise.resolve();let i=await this.container.git.getRepositoryService(t.repoPath).branches.getBranch();if(null==i)return;let r=await this.container.git.getRepositoryService(t.repoPath).refs.getMergeBase(i.ref,t.ref);if(null!=r)return this.container.views.searchAndCompare.compare(t.repoPath,t.ref,{ref:r,label:`${i.ref} (${(0,V.pV)(r)})`})}async openChangedFileDiffsWithMergeBase(e){let t=this.getGraphItemRef(e);if(null==t)return Promise.resolve();let i=await this.container.git.getRepositoryService(t.repoPath).branches.getBranch();if(null==i)return;let r=await this.container.git.getRepositoryService(t.repoPath).refs.getMergeBase(i.ref,t.ref);if(null!=r)return(0,c.$5)(this.container,{repoPath:t.repoPath,lhs:r,rhs:t.ref},{title:`Changes between ${i.ref} (${(0,V.pV)(r)}) ${o.EO.ArrowLeftRightLong} ${(0,V.pV)(t.ref,{strings:{working:"Working Tree"}})}`})}compareWithUpstream(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue;if(null!=t.upstream)return this.container.views.searchAndCompare.compare(t.repoPath,t.ref,t.upstream.name)}return Promise.resolve()}changeUpstreamBranch(e){if(!ep(e,"branch"))return Promise.resolve();let{ref:t}=e.webviewItemValue;return p.iW(t.repoPath,t)}compareWorkingWith(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():this.container.views.searchAndCompare.compare(t.repoPath,"",t.ref)}copyWorkingChangesToWorktree(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():f.PB("working-tree",t.repoPath)}generateCommitMessage(e){let t=this.getGraphItemRef(e);return null==t?Promise.resolve():(0,E.RS)("gitlens.ai.generateCommitMessage",{repoPath:t.repoPath,source:"graph"})}aiExplainUnpushed(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue;return t.upstream?(0,E.RS)("gitlens.ai.explainBranch",{repoPath:t.repoPath,ref:t.ref,baseBranch:t.upstream.name,source:{source:"graph",context:{type:"branch"}}}):Promise.resolve()}return Promise.resolve()}explainBranch(e){let t=this.getGraphItemRef(e,"branch");return null==t?Promise.resolve():(0,E.RS)("gitlens.ai.explainBranch",{repoPath:t.repoPath,ref:t.ref,source:{source:"graph",context:{type:"branch"}}})}recomposeBranch(e){let t=this.getGraphItemRef(e,"branch");return null==t?Promise.resolve():(0,E.RS)("gitlens.recomposeBranch",{repoPath:t.repoPath,branchName:t.name,source:"graph"})}explainCommit(e){let t=this.getGraphItemRef(e,"revision");return null==t?Promise.resolve():(0,E.RS)("gitlens.ai.explainCommit",{repoPath:t.repoPath,rev:t.ref,source:{source:"graph",context:{type:"commit"}}})}explainStash(e){let t=this.getGraphItemRef(e,"stash");return null==t?Promise.resolve():(0,E.RS)("gitlens.ai.explainStash",{repoPath:t.repoPath,rev:t.ref,source:{source:"graph",context:{type:"stash"}}})}explainWip(e){let t=this.getGraphItemRef(e,"revision");return null==t?Promise.resolve():(0,E.RS)("gitlens.ai.explainWip",{repoPath:t.repoPath,source:{source:"graph",context:{type:"wip"}}})}async openFiles(e){let t=await this.getCommitFromGraphItemRef(e);if(null!=t)return(0,c.Km)(t)}async openAllChanges(e,t){let i=await this.getCommitFromGraphItemRef(e);if(null!=i)return(0,c.P3)(this.container,i,t)}async openAllChangesWithWorking(e,t){let i=await this.getCommitFromGraphItemRef(e);if(null!=i)return(0,c.Qv)(this.container,i,t)}async openRevisions(e){let t=await this.getCommitFromGraphItemRef(e);if(null!=t)return(0,c.m)(t)}async openOnlyChangedFiles(e){let t=await this.getCommitFromGraphItemRef(e);if(null!=t)return(0,c.E9)(this.container,t)}async openInWorktree(e){if(ep(e,"branch")){let{ref:t}=e.webviewItemValue,i=this.container.git.getRepository(t.repoPath),r=await i?.git.branches.getBranch(t.name),s=await r?.getAssociatedPullRequest();if(null!=r&&null!=i&&null!=s){let e=(await r.getRemote())?.url??(0,B.Yv)(s).remote.url;if(null!=e){let t=(0,A.pX)(this.container,s,r.getNameWithoutRemote(),e,ei.zB.SwitchToPullRequestWorktree);return this.container.deepLinks.processDeepLinkUri(t,!1,i)}}await (0,l.b)({command:"switch",state:{repos:t.repoPath,reference:t,worktreeDefaultOpen:"new"}})}}async openWorktree(e,t){if(ep(e,"branch")){let i,{ref:r}=e.webviewItemValue;if(null==r.id)return;if(r.repoPath===this._graph?.repoPath)i=this._graph?.worktreesByBranch;else{let e=this.container.git.getRepository(r.repoPath);if(null==e)return;i=await (0,I.Ao)(e)}let s=i?.get(r.id);null!=s&&(0,j.OH)(s.uri,t)}}addAuthor(e){if(el(e,"contributor")){let{repoPath:t,name:i,email:r,current:s}=e.webviewItemValue;return g.s(t,new C.s(t,i,r,s??!1,0))}return Promise.resolve()}async toggleColumn(e,t){let i=this.container.storage.getWorkspace("graph:columns"),r=i?.[e];null!=r?r.isHidden=!t:r={isHidden:!t},i=(0,K.Y8)(i,e,r),await this.container.storage.storeWorkspace("graph:columns",i),this.notifyDidChangeColumns(),"changes"!==e||r.isHidden||this._graph?.includes?.stats||this.updateState()}async toggleScrollMarker(e,t){let i=z.H.get("graph.scrollMarkers.additionalTypes"),r=!1;t&&!i.includes(e)?(i=i.concat(e),r=!0):!t&&i.includes(e)&&(i=i.filter(t=>t!==e),r=!0),r&&(await z.H.updateEffective("graph.scrollMarkers.additionalTypes",i),this.notifyDidChangeScrollMarkers())}async setColumnMode(e,t){let i=this.container.storage.getWorkspace("graph:columns"),r=i?.[e];null!=r?r.mode=t:r={mode:t},i=(0,K.Y8)(i,e,r),await this.container.storage.storeWorkspace("graph:columns",i),this.notifyDidChangeColumns()}async generateChangelogFrom(e){if(ep(e,"branch")||ep(e,"tag")){let{ref:t}=e.webviewItemValue;await (0,E.RS)("gitlens.ai.generateChangelog",{repoPath:t.repoPath,head:t,source:{source:"graph",detail:ep(e,"branch")?"branch":"tag"}})}return Promise.resolve()}async composeCommits(e){if(ep(e,"revision")){let{ref:t}=e.webviewItemValue;await (0,E.RS)("gitlens.composeCommits",{repoPath:t.repoPath,source:"graph"})}return Promise.resolve()}async rebaseOntoCommit(e){let t=this.getGraphItemRef(e,"revision");if(null==t)return Promise.resolve();await (0,E.RS)("gitlens.ai.generateRebase",{repoPath:t.repoPath,base:t,head:(0,x.kA)("HEAD",t.repoPath,{refType:"revision",name:"HEAD"}),source:{source:"graph"}})}visualizeHistoryRepo(){(0,E.RS)("gitlens.visualizeHistory",null!=this.repository?{type:"repo",uri:this.repository.uri}:void 0)}getCommitFromGraphItemRef(e){let t=this.getGraphItemRef(e,"revision");return null!=t||null!=(t=this.getGraphItemRef(e,"stash"))?this.container.git.getRepositoryService(t.repoPath).commits.getCommit(t.ref):Promise.resolve(void 0)}getGraphItemRef(e,t){if(null==e){let e=this.activeSelection;return null!=e&&(null==t||t===e.refType)?e:void 0}switch(t){case"branch":return ep(e,"branch")||el(e,"upstreamStatus")?e.webviewItemValue.ref:void 0;case"revision":return ep(e,"revision")?e.webviewItemValue.ref:void 0;case"stash":return ep(e,"stash")?e.webviewItemValue.ref:void 0;case"tag":return ep(e,"tag")?e.webviewItemValue.ref:void 0;default:return ep(e)?e.webviewItemValue.ref:void 0}}getGraphItemRefs(e,t){if(null==e)return{active:void 0,selection:[]};switch(t){case"branch":if(!ep(e,"branch")&&!el(e,"upstreamStatus"))return{active:void 0,selection:[]};break;case"revision":if(!ep(e,"revision"))return{active:void 0,selection:[]};break;case"stash":if(!ep(e,"stash"))return{active:void 0,selection:[]};break;case"tag":if(!ep(e,"tag"))return{active:void 0,selection:[]};break;default:if(!ep(e))return{active:void 0,selection:[]}}let i=e.webviewItemsValues?.map(e=>e.webviewItemValue.ref)??[];return i.length||i.push(e.webviewItemValue.ref),{active:e.webviewItemValue.ref,selection:i}}createCancellation(e){this.cancelOperation(e);let t=new r.CancellationTokenSource;return this._cancellations.set(e,t),t}cancelOperation(e){this._cancellations.get(e)?.cancel(),this._cancellations.delete(e)}};function te(e,t){return t??e.remote?{id:e.id,type:"remote",name:e.getNameWithoutRemote(),owner:e.getRemoteName()}:{id:e.id,type:"head",name:e.name}}function tt(e){if(null!=e.upstream&&!e.upstream.missing)return{id:(0,M.Yk)(e.repoPath,!0,e.upstream.name),type:"remote",name:(0,M.km)(e.upstream.name),owner:e.getRemoteName()}}function ti(e){switch(e.refType){case"branch":if(e.remote)return"remote";if(e.worktree)return"worktree";return"head";case"tag":return"tag";default:return}}e6([(0,Y.Yz)({args:!1})],GraphWebviewProvider.prototype,"onContextChanged",1),e6([(0,Y.Yz)({args:!1})],GraphWebviewProvider.prototype,"onFeaturePreviewChanged",1),e6([(0,Y.Yz)({args:{0:e=>e.toString()}})],GraphWebviewProvider.prototype,"onRepositoryChanged",1),e6([(0,Y.Yz)({args:!1})],GraphWebviewProvider.prototype,"onRepositoryFileSystemChanged",1),e6([(0,Y.Yz)({args:!1})],GraphWebviewProvider.prototype,"onSubscriptionChanged",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"onEnsureRowRequest",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"onGetMoreRows",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"onOpenPullRequestDetails",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"onSearchHistoryGetRequest",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"onSearchHistoryStoreRequest",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"onSearchHistoryDeleteRequest",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"onSearchRequest",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"updateState",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"updateAvatars",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeAvatars",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeBranchState",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"updateRefsMetadata",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeRefsMetadata",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeColumns",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeScrollMarkers",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeRefsVisibility",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeConfiguration",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidFetch",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeRows",1),e6([(0,Y.Yz)({args:!1})],GraphWebviewProvider.prototype,"notifyDidChangeRowsStats",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidStartFeaturePreview",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeWorkingTree",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeSelection",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeSubscription",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeOrgSettings",1),e6([(0,Y.Yz)()],GraphWebviewProvider.prototype,"notifyDidChangeState",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"fetch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"forcePush",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"pull",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"push",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"createBranch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"deleteBranch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"star",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"unstar",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"mergeBranchInto",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openBranchOnRemote",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"publishBranch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"rebase",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"rebaseToRemote",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"renameBranch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"associateIssueWithBranch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"cherryPick",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"copy",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"copyMessage",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"copySha",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openInDetailsView",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"commitViaSCM",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openCommitOnRemote",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"compareSelectedCommits",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"abortPausedOperation",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"continuePausedOperation",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openRebaseEditor",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"skipPausedOperation",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"copyDeepLinkToBranch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"copyDeepLinkToCommit",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"copyDeepLinkToRepo",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"copyDeepLinkToTag",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"shareAsCloudPatch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"copyPatchToClipboard",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"resetCommit",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"resetToCommit",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"resetToTip",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"revertCommit",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"switchTo",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"resetToTag",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"hideRef",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"soloReference",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"switchToAnother",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"undoCommit",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"saveStash",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"applyStash",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"deleteStash",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"renameStash",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"createTag",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"deleteTag",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"createWorktree",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"createPullRequest",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openPullRequest",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openPullRequestChanges",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openPullRequestComparison",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openPullRequestOnRemote",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openIssueOnRemote",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"compareAncestryWithWorking",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"compareHeadWith",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"compareBranchWithHead",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"compareWithMergeBase",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openChangedFileDiffsWithMergeBase",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"compareWithUpstream",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"changeUpstreamBranch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"compareWorkingWith",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"copyWorkingChangesToWorktree",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"generateCommitMessage",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"aiExplainUnpushed",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"explainBranch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"recomposeBranch",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"explainCommit",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"explainStash",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"explainWip",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openFiles",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openAllChanges",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openAllChangesWithWorking",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openRevisions",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openOnlyChangedFiles",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openInWorktree",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"openWorktree",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"addAuthor",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"toggleColumn",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"toggleScrollMarker",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"setColumnMode",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"generateChangelogFrom",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"composeCommits",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"rebaseOntoCommit",1),e6([(0,Y.Rm)()],GraphWebviewProvider.prototype,"visualizeHistoryRepo",1)}};