exports.id=459,exports.ids=[459],exports.modules={3562:(e,t,r)=>{r.d(t,{GutterChangesAnnotationProvider:()=>GutterChangesAnnotationProvider});var o=r(1398),i=r(928),n=r(6402),a=r(6434),s=r(9135),l=r(7820),u=r(3582),d=r(6156),h=r(9667),c=Object.defineProperty,p=Object.getOwnPropertyDescriptor,g=e=>{throw TypeError(e)};let m=0x40000000-1;let GutterChangesAnnotationProvider=class GutterChangesAnnotationProvider extends d.wJ{hoverProviderDisposable;sortedHunkStarts;state;constructor(e,t,r,o){super(e,t,"changes",r,o)}canReuse(e){return this.annotationContext?.sha===e?.sha&&this.annotationContext?.only===e?.only}clear(){return this.state=void 0,null!=this.hoverProviderDisposable&&(this.hoverProviderDisposable.dispose(),this.hoverProviderDisposable=void 0),super.clear()}nextChange(){if(null==this.sortedHunkStarts)return;let e=-1,t=this.editor.selection.active.line;for(let r of this.sortedHunkStarts)if(r>t){e=r;break}-1===e&&(e=this.sortedHunkStarts[0]),e>0&&(this.editor.selection=new o.Selection(e,0,e,0),this.editor.revealRange(new o.Range(e,0,e,0),o.TextEditorRevealType.InCenterIfOutsideViewport))}previousChange(){if(null==this.sortedHunkStarts)return;let e=-1,t=this.editor.selection.active.line;for(let r of this.sortedHunkStarts){if(r>=t)break;e=r}-1===e&&(e=this.sortedHunkStarts[this.sortedHunkStarts.length-1]),e>0&&(this.editor.selection=new o.Selection(e,0,e,0),this.editor.revealRange(new o.Range(e,0,e,0),o.TextEditorRevealType.InCenterIfOutsideViewport))}async onProvideAnnotation(e,t){var r,i,n,a,d,c=[];try{let r,i,n=(0,s.dQ)(),a=this.trackedDocument.uri.sha,d=e?.sha!=null&&e.sha!==a?`${e.sha}^`:void 0,p=this.container.git.getRepositoryService(this.trackedDocument.uri.repoPath),f=null==a&&null==d;if(f){let e=await p.commits.getOldestUnpushedShaForPath(this.trackedDocument.uri);if(null!=e)e=`${e}^`,r=await p.commits.getCommitForFile(this.trackedDocument.uri,e),null!=r?null!=d?d=e:(a=e,d=""):f=!1;else{let e=await p.status.getStatusForFile?.(this.trackedDocument.uri),t=e?.getPseudoCommits(this.container,await p.config.getCurrentUser());t?.length?(r=await p.commits.getCommitForFile(this.trackedDocument.uri),a="HEAD"):this.trackedDocument.dirty?a="HEAD":f=!1}}f||(r=await p.commits.getCommitForFile(this.trackedDocument.uri,d??a),null!=r&&(null!=d||(a=`${r.ref}^`),d=r.ref));let v=(await Promise.allSettled(null==d&&this.editor.document.isDirty?[this.container.git.getDiffForFileContents(this.trackedDocument.uri,a,this.editor.document.getText()),this.container.git.getDiffForFile(this.trackedDocument.uri,a,d)]:[this.container.git.getDiffForFile(this.trackedDocument.uri,a,d)])).map(e=>(0,l.Ro)(e)).filter(e=>!!e);if(!v?.length)return!1;let y=((e,t,r)=>{if(null!=t){var o,i;let r,n;"object"!=typeof t&&"function"!=typeof t&&g("Object expected"),void 0===o&&(o=t[r="dispose",(n=Symbol[r])?n:Symbol.for("Symbol."+r)]),"function"!=typeof o&&g("Object not disposable"),i&&(o=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.push([void 0,o,t])}return t})(c,(0,u.u)(n)),b=new Map,w=e?.sha!=null&&e?.only?await this.container.git.getBlame(this.trackedDocument.uri,this.editor?.document):void 0;for(let t of(this.sortedHunkStarts=[],v))for(let r of t.hunks){if(null!=w){let t=!0,o=e.sha;for(let e=r.current.position.start-1;e<r.current.position.end;e++)w.lines[e]?.sha===o&&(t=!1);if(t)continue}for(let[e,t]of r.lines){if("unchanged"===t.state)continue;let r=this.editor.document.validateRange(new o.Range(new o.Position(e-1,0),new o.Position(e-1,m)));this.sortedHunkStarts.push(r.start.line),null==i&&(i=new o.Selection(r.start,r.end));let n=b.get(t.state);null==n?(n={decorationType:"added"===t.state?h.I.changesLineAddedAnnotation:"removed"===t.state?h.I.changesLineDeletedAnnotation:h.I.changesLineChangedAnnotation,rangesOrOptions:[{range:r}]},b.set(t.state,n)):n.rangesOrOptions.push({range:r})}}return this.sortedHunkStarts.sort((e,t)=>e-t),y?.restart({suffix:" to compute recent changes annotations"}),b.size&&(this.setDecorations([...b.values()]),y?.stop({suffix:" to apply all recent changes annotations"}),null==i||e?.selection===!1||t?.restoring||(this.editor.selection=i,this.editor.revealRange(i,o.TextEditorRevealType.InCenterIfOutsideViewport))),this.state={commit:r,diffs:v},this.registerHoverProvider(),!0}catch(e){var p=e,f=!0}finally{r=p,i=f,n="function"==typeof SuppressedError?SuppressedError:function(e,t,r,o){return(o=Error(r)).name="SuppressedError",o.error=e,o.suppressed=t,o},a=e=>r=i?new n(e,r,"An error was suppressed during disposal"):(i=!0,e),(d=e=>{for(;e=c.pop();)try{var t=e[1]&&e[1].call(e[2]);if(e[0])return Promise.resolve(t).then(d,e=>(a(e),d()))}catch(e){a(e)}if(i)throw r})()}}registerHoverProvider(){let e=n.H.get("hovers");e.enabled&&e.annotations.enabled&&(this.hoverProviderDisposable?.dispose(),this.hoverProviderDisposable=o.languages.registerHoverProvider({pattern:this.editor.document.uri.fsPath},{provideHover:(e,t,r)=>this.provideHover(e,t,r)}))}async provideHover(e,t,r){if(null==this.state||"line"!==n.H.get("hovers.annotations.over")&&0!==t.character)return;let{commit:a,diffs:s}=this.state;for(let r of s)for(let n of r.hunks){let r=n.previous.count>n.current.count;if(t.line>=n.current.position.start-1&&t.line<=n.current.position.end-!r){let s=await (0,i.ec)(a,this.trackedDocument.uri,t.line,n);if(null==s)return;return new o.Hover(s,e.validateRange(new o.Range(n.current.position.start-1,0,n.current.position.end-!r,m)))}}}};((e,t,r,o)=>{for(var i,n=p(t,r),a=e.length-1;a>=0;a--)(i=e[a])&&(n=i(t,r,n)||n);return n&&c(t,r,n)})([(0,a.Rm)()],GutterChangesAnnotationProvider.prototype,"onProvideAnnotation",0)},5704:(e,t,r)=>{r.d(t,{GutterHeatmapBlameAnnotationProvider:()=>GutterHeatmapBlameAnnotationProvider});var o=r(1398),i=r(6434),n=r(9135),a=r(3582),s=r(2352),l=r(9193),u=Object.defineProperty,d=Object.getOwnPropertyDescriptor,h=e=>{throw TypeError(e)};let GutterHeatmapBlameAnnotationProvider=class GutterHeatmapBlameAnnotationProvider extends l.z{constructor(e,t,r,o){super(e,t,"heatmap",r,o)}async onProvideAnnotation(e,t){var r,i,l,u,d,c=[];try{let e,r=(0,n.dQ)(),i=await this.getBlame(t?.recompute);if(null==i)return!1;let l=((e,t,r)=>{if(null!=t){var o,i;let r,n;"object"!=typeof t&&"function"!=typeof t&&h("Object expected"),void 0===o&&(o=t[r="dispose",(n=Symbol[r])?n:Symbol.for("Symbol."+r)]),"function"!=typeof o&&h("Object not disposable"),i&&(o=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.push([void 0,o,t])}return t})(c,(0,a.u)(r)),u=new Map,d=this.getComputedHeatmap(i);for(let t of i.lines){let r=t.line-1;e=i.commits.get(t.sha),null!=e&&(0,s.n0)(e.date,d,new o.Range(r,0,r,0),u)}return l?.restart({suffix:" to compute heatmap annotations"}),u.size&&(this.setDecorations([...u.values()]),l?.stop({suffix:" to apply all heatmap annotations"})),!0}catch(e){var p=e,g=!0}finally{r=p,i=g,l="function"==typeof SuppressedError?SuppressedError:function(e,t,r,o){return(o=Error(r)).name="SuppressedError",o.error=e,o.suppressed=t,o},u=e=>r=i?new l(e,r,"An error was suppressed during disposal"):(i=!0,e),(d=e=>{for(;e=c.pop();)try{var t=e[1]&&e[1].call(e[2]);if(e[0])return Promise.resolve(t).then(d,e=>(u(e),d()))}catch(e){u(e)}if(i)throw r})()}}};((e,t,r,o)=>{for(var i,n=d(t,r),a=e.length-1;a>=0;a--)(i=e[a])&&(n=i(t,r,n)||n);return n&&u(t,r,n)})([(0,i.Rm)()],GutterHeatmapBlameAnnotationProvider.prototype,"onProvideAnnotation",0)},8344:(e,t,r)=>{r.d(t,{GutterBlameAnnotationProvider:()=>GutterBlameAnnotationProvider});var o=r(1398),i=r(746),n=r(819),a=r(6402),s=r(7672),l=r(6434),u=r(3991),d=r(9135),h=r(3582),c=r(9204),p=r(2352),g=r(9193),m=r(9667),f=Object.defineProperty,v=Object.getOwnPropertyDescriptor,y=e=>{throw TypeError(e)},b=(e,t,r,o)=>{for(var i,n=o>1?void 0:o?v(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(n=(o?i(t,r,n):i(n))||n);return o&&n&&f(t,r,n),n};let w=0x40000000-1;let GutterBlameAnnotationProvider=class GutterBlameAnnotationProvider extends g.z{constructor(e,t,r,o){super(e,t,"blame",r,o)}async clear(){if(await super.clear(),null!=m.I.gutterBlameHighlight)try{this.editor.setDecorations(m.I.gutterBlameHighlight,[])}catch{}}async onProvideAnnotation(e,t){var r,s,l,u,g,f=[];try{let e,r,s,l,u,g,v=(0,d.dQ)(),b=await this.getBlame(t?.recompute);if(null==b)return!1;let w=((e,t,r)=>{if(null!=t){var o,i;let r,n;"object"!=typeof t&&"function"!=typeof t&&y("Object expected"),void 0===o&&(o=t[r="dispose",(n=Symbol[r])?n:Symbol.for("Symbol."+r)]),"function"!=typeof o&&y("Object not disposable"),i&&(o=function(){try{i.call(this)}catch(e){return Promise.reject(e)}}),e.push([void 0,o,t])}return t})(f,(0,h.u)(v)),P=a.H.get("blame"),D=(0,c.Vx)(P.format).reduce((e,t)=>(e[t.key]=t.options,e),Object.create(null));n.c.has(P.format,"tips")&&(e=await this.container.git.getRepositoryService(b.repoPath).getBranchesAndTagsTipsLookup());let H={dateFormat:null===P.dateFormat?a.H.get("defaultDateFormat"):P.dateFormat,getBranchAndTagTips:e,tokenOptions:D},x={family:a.H.get("blame.fontFamily"),size:a.H.get("blame.fontSize"),style:a.H.get("blame.fontStyle"),weight:a.H.get("blame.fontWeight")},S=P.avatars,k=a.H.get("defaultGravatarsStyle"),A=P.separateLines,O=(0,p.kM)(A,P.heatmap,P.avatars,P.format,H,x),R=[],B=new Map,T=S?new Map:void 0,C=!1;for(let e of(P.heatmap.enabled&&(u=this.getComputedHeatmap(b)),b.lines)){let t=e.line-1;if(l===e.sha){if(null==s)continue;s={...s},P.compact&&!C&&(null==g&&(g=i.EO.Space.repeat((0,c.RG)(s.renderOptions.before.contentText))),s.renderOptions={before:{...s.renderOptions.before,contentText:g}},A&&(s.renderOptions.before.textDecoration=`none;box-sizing: border-box${S?";padding: 0 0 0 18px":""}${x.family?`;font-family: ${x.family}`:""}${x.size?`;font-size: ${x.size}px`:""}`),C=!0),s.range=new o.Range(t,0,t,0),R.push(s);continue}if(C=!1,l=e.sha,r=b.commits.get(e.sha),null!=r){if(s=B.get(e.sha),null!=s){s={...s,range:new o.Range(t,0,t,0)},R.push(s);continue}s=(0,p.w)(r,P.format,H,O),null!=u&&(0,p.nx)(s,r.date,u),s.range=new o.Range(t,0,t,0),R.push(s),S&&null!=r.author.email&&await this.applyAvatarDecoration(r,s,k,T),B.set(e.sha,s)}}return w?.restart({suffix:" to compute gutter blame annotations"}),R.length&&(this.setDecorations([{decorationType:m.I.gutterBlameAnnotation,rangesOrOptions:R}]),w?.stop({suffix:" to apply all gutter blame annotations"})),this.registerHoverProviders(a.H.get("hovers.annotations")),!0}catch(e){var v=e,b=!0}finally{r=v,s=b,l="function"==typeof SuppressedError?SuppressedError:function(e,t,r,o){return(o=Error(r)).name="SuppressedError",o.error=e,o.suppressed=t,o},u=e=>r=s?new l(e,r,"An error was suppressed during disposal"):(s=!0,e),(g=e=>{for(;e=f.pop();)try{var t=e[1]&&e[1].call(e[2]);if(e[0])return Promise.resolve(t).then(g,e=>(u(e),g()))}catch(e){u(e)}if(s)throw r})()}}async selection(e){let t;if(!1===e||null==m.I.gutterBlameHighlight)return;let r=await this.blame;if(!r?.lines.length)return;if(e?.sha!=null)t=e.sha;else if(e?.line!=null){if(e.line>=0){let o=r.lines[e.line];t=o?.sha}}else t=(0,u.$1)(r.commits.values())?.sha;if(!t)return void this.editor.setDecorations(m.I.gutterBlameHighlight,[]);let i=(0,s.x1)(r.lines,e=>e.sha===t?this.editor.document.validateRange(new o.Range(e.line-1,0,e.line-1,w)):void 0);this.editor.setDecorations(m.I.gutterBlameHighlight,i)}async applyAvatarDecoration(e,t,r,o){let i=o.get(e.author.email??"");if(null==i){let t=(await e.getAvatarUri({defaultStyle:r,size:16})).toString(!0);i={contentText:"",height:"16px",width:"16px",textDecoration:`none;position:absolute;top:1px;left:5px;background:url(${encodeURI(t)});background-size:16px 16px;margin-left: 0 !important`},o.set(e.author.email??"",i)}t.renderOptions.after=i}};b([(0,l.Rm)()],GutterBlameAnnotationProvider.prototype,"onProvideAnnotation",1),b([(0,l.Rm)({args:!1})],GutterBlameAnnotationProvider.prototype,"selection",1)},9193:(e,t,r)=>{r.d(t,{z:()=>BlameAnnotationProviderBase});var o=r(1398),i=r(5439),n=r(928),a=r(6402),s=r(6434),l=r(6156),u=r(2352),d=Object.defineProperty,h=Object.getOwnPropertyDescriptor;let c=0x40000000-1;let BlameAnnotationProviderBase=class BlameAnnotationProviderBase extends l.wJ{blame;hoverProviderDisposable;constructor(e,t,r,o,i){super(e,t,r,o,i),this.blame=e.git.getBlame(this.trackedDocument.uri,o.document),o.document.isDirty&&i.setForceDirtyStateChangeOnNextDocumentChange()}clear(){return null!=this.hoverProviderDisposable&&(this.hoverProviderDisposable.dispose(),this.hoverProviderDisposable=void 0),super.clear()}async validate(){let e=await this.blame;return!!e?.lines.length}async getBlame(e){e&&(this.blame=this.container.git.getBlame(this.trackedDocument.uri,this.editor.document));let t=await this.blame;if(t?.lines.length)return t}getComputedHeatmap(e){let t,r,o,i=[];for(let o of e.lines)r!==o.sha&&(r=o.sha,null!=(t=e.commits.get(o.sha))&&i.push(t.date));i.sort((e,t)=>e.getTime()-t.getTime());let n=new Date;n.setDate(n.getDate()-(a.H.get("heatmap.ageThreshold")||90));let s=n.getTime(),l=[],d=[];for(let e of i)e.getTime()<s?d.push(e):l.push(e);o=l.length&&d.length?{hot:p(l),cold:p(d)}:p(i);let h=(e,t)=>Array.isArray(o)?o:t?o.hot.concat(o.cold):e.getTime()<s?o.cold:o.hot,c=(e,t)=>{let r=e.getTime(),o=0;for(let e=0;e<t.length&&(o=e,!(r>=t[e]));e++);return o};return{coldThresholdTimestamp:s,colors:(0,u.v7)(),computeRelativeAge:e=>c(e,h(e)),computeOpacity:e=>{let t=h(e,!0);return Math.max(.2,Math.round((1-c(e,t)/t.length)*100)/100)}}}registerHoverProviders(e){let t=a.H.get("hovers");t.enabled&&t.annotations.enabled&&(e.details||e.changes)&&(this.hoverProviderDisposable?.dispose(),this.hoverProviderDisposable=o.languages.registerHoverProvider({pattern:this.editor.document.uri.fsPath},{provideHover:(t,r,o)=>this.provideHover(e,t,r,o)}))}async provideHover(e,t,r,s){if("line"!==a.H.get("hovers.annotations.over")&&0!==r.character||this.editor.document.uri.toString()!==t.uri.toString())return;let l=await this.getBlame();if(null==l)return;let u=l.lines[r.line],d=l.commits.get(u.sha);if(null==d)return;let h=(await Promise.all([e.details?this.getDetailsHoverMessage(d,t):void 0,e.changes?(0,n.PV)(this.container,d,await i.nk.fromUri(t.uri),r.line,t):void 0])).filter(e=>!!e);return new o.Hover(h,t.validateRange(new o.Range(r.line,0,r.line,c)))}async getDetailsHoverMessage(e,t){let r=this.editor.selection.active.line,o=r+1;r=(e.lines.find(e=>e.line===o)??e.lines[0]).originalLine-1;let s=a.H.get("hovers");return(0,n.MX)(this.container,e,await i.nk.fromUri(t.uri),r,{autolinks:s.autolinks.enabled,dateFormat:a.H.get("defaultDateFormat"),format:s.detailsMarkdownFormat,pullRequests:s.pullRequests.enabled,timeout:250})}};function p(e){let t=[],r=Math.floor(e.length/2),o=e.length%2?e[r].getTime():(e[r-1].getTime()+e[r].getTime())/2,i=(e[e.length-1].getTime()-o)/5;for(let e=5;e>0;e--)t.push(o+i*e);t.push(o),i=(o-e[0].getTime())/4;for(let e=1;e<=4;e++)t.push(o-i*e);return t}((e,t,r,o)=>{for(var i,n=h(t,r),a=e.length-1;a>=0;a--)(i=e[a])&&(n=i(t,r,n)||n);return n&&d(t,r,n)})([(0,s.Rm)({args:!1})],BlameAnnotationProviderBase.prototype,"getComputedHeatmap",0)}};